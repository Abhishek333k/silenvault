<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Budget Planner | SilenVault</title>
    <meta name="description" content="Free local-first project budget planner. Track expenses, estimate costs, and save your data securely in your browser.">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="../assets/js/layout.js" defer></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #e2e8f0; }
        .glass-panel { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(51, 65, 85, 0.5); }
        .input-dark { background: #0f172a; border: 1px solid #1e293b; color: white; border-radius: 0.5rem; transition: all 0.2s; }
        .input-dark:focus { border-color: #3b82f6; outline: none; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); }
        
        /* Hide print-only elements on screen */
        #print-container { display: none; }

        @media print {
            /* 1. Reset everything for paper */
            body { background: white !important; color: black !important; margin: 0; padding: 0; }
            sv-header, sv-footer, main, .smart-ad-unit { display: none !important; }

            /* 2. Reveal and Style the Print Container */
            #print-container { 
                display: block !important; 
                padding: 40px; 
                font-family: 'Inter', sans-serif;
            }
            .print-header { border-bottom: 2px solid #000; padding-bottom: 20px; margin-bottom: 30px; }
            .print-title { font-size: 28px; font-weight: bold; margin: 0; }
            .print-date { color: #666; font-size: 12px; margin-top: 5px; }
            
            .print-summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 40px; }
            .print-stat-box { border: 1px solid #eee; padding: 15px; border-radius: 8px; }
            .print-stat-label { font-size: 10px; text-transform: uppercase; color: #666; font-weight: bold; }
            .print-stat-value { font-size: 20px; font-weight: bold; margin-top: 5px; }

            .print-table { width: 100%; border-collapse: collapse; }
            .print-table th { background: #f8fafc; border-bottom: 2px solid #e2e8f0; padding: 12px; text-align: left; font-size: 11px; text-transform: uppercase; }
            .print-table td { padding: 12px; border-bottom: 1px solid #eee; font-size: 13px; }
            .print-footer { margin-top: 50px; border-top: 1px solid #eee; padding-top: 20px; text-align: center; font-size: 10px; color: #aaa; }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="print-container">
        <div class="print-header">
            <div class="print-title">Project Budget Report</div>
            <div class="print-date" id="p-date"></div>
        </div>
        
        <div class="print-summary-grid">
            <div class="print-stat-box">
                <div class="print-stat-label">Total Budget</div>
                <div class="print-stat-value" id="p-total"></div>
            </div>
            <div class="print-stat-box">
                <div class="print-stat-label">Total Spent</div>
                <div class="print-stat-value" id="p-spent"></div>
            </div>
            <div class="print-stat-box">
                <div class="print-stat-label">Remaining Balance</div>
                <div class="print-stat-value" id="p-remain"></div>
            </div>
        </div>

        <table class="print-table">
            <thead>
                <tr>
                    <th>Item Description</th>
                    <th>Category</th>
                    <th style="text-align: right;">Cost (₹)</th>
                </tr>
            </thead>
            <tbody id="print-list">
                </tbody>
        </table>

        <div class="print-footer">
            Generated via SilenVault Budget Architect • Local-First Security
        </div>
    </div>

    <sv-header base-path=".."></sv-header>

    <main class="flex-1 max-w-7xl mx-auto w-full px-4 py-12 flex flex-col lg:flex-row gap-8">
        
        <div class="flex-1 space-y-6">
            <div class="text-center mb-8">
                <h1 class="text-3xl md:text-5xl font-bold text-white mb-4 tracking-tight">
                    Budget <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-400">Architect</span>
                </h1>
                <p class="text-slate-400 max-w-lg mx-auto">
                    Plan your next project with zero data leaks. Data is saved automatically to your device.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="glass-panel p-6 rounded-2xl border-blue-500/20">
                    <span class="text-xs font-bold text-slate-500 uppercase tracking-wider">Total Budget</span>
                    <div id="totalBudget" class="text-2xl font-mono font-bold text-white mt-1">₹0.00</div>
                </div>
                <div class="glass-panel p-6 rounded-2xl border-emerald-500/20">
                    <span class="text-xs font-bold text-slate-500 uppercase tracking-wider">Remaining</span>
                    <div id="remainingBudget" class="text-2xl font-mono font-bold text-emerald-400 mt-1">₹0.00</div>
                </div>
                <div class="glass-panel p-6 rounded-2xl border-red-500/20">
                    <span class="text-xs font-bold text-slate-500 uppercase tracking-wider">Spent</span>
                    <div id="totalSpent" class="text-2xl font-mono font-bold text-red-400 mt-1">₹0.00</div>
                </div>
            </div>

            <div class="glass-panel p-6 rounded-2xl flex flex-wrap gap-4 items-end controls-area">
                <div class="flex-1 min-w-[200px]">
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2 ml-1">Overall Project Limit</label>
                    <input type="number" id="projectLimit" value="50000" oninput="updateCalculations()" class="w-full input-dark px-4 py-3 font-mono">
                </div>
                
                <div class="flex flex-wrap gap-2">
                    <button onclick="addItem()" class="bg-blue-600 hover:bg-blue-500 text-white font-bold px-5 py-3 rounded-xl transition-all flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                        Add Item
                    </button>
                    
                    <button onclick="exportToCSV()" class="bg-slate-800 hover:bg-slate-700 text-slate-300 font-bold px-5 py-3 rounded-xl border border-slate-700 transition-all flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                        Excel
                    </button>

                    <button onclick="prepareAndPrint()" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold px-5 py-3 rounded-xl shadow-lg shadow-indigo-500/20 transition-all flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/></svg>
                        Export PDF
                    </button>
                    
                    <button onclick="clearAll()" class="px-5 py-3 rounded-xl border border-slate-700 text-slate-500 hover:text-red-400 hover:border-red-400/30 transition-all font-bold text-xs">
                        Clear All
                    </button>
                </div>
            </div>

            <div class="glass-panel rounded-2xl overflow-hidden">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-slate-900/50 text-slate-500 uppercase text-[10px] font-bold tracking-widest">
                        <tr>
                            <th class="px-6 py-4">Item / Description</th>
                            <th class="px-6 py-4">Category</th>
                            <th class="px-6 py-4 text-right">Cost (₹)</th>
                            <th class="px-6 py-4 w-16"></th>
                        </tr>
                    </thead>
                    <tbody id="expenseList" class="divide-y divide-slate-800"></tbody>
                </table>
            </div>

            <div class="smart-ad-unit w-full text-center overflow-hidden transition-all duration-500">
                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5449371042798610" data-ad-slot="7594122081" data-ad-format="auto" data-full-width-responsive="true"></ins>
                <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>
        </div>

        <aside class="w-full lg:w-80 flex flex-col gap-6 shrink-0">
            <div class="glass-panel p-6 rounded-2xl">
                <h3 class="font-bold text-white mb-4 uppercase tracking-wider text-xs text-blue-400">Privacy First</h3>
                <p class="text-xs text-slate-400 leading-relaxed">
                    SilenVault uses <strong>WebStorage API</strong>. Data is stored locally in your browser. We never see your project numbers.
                </p>
            </div>
            <div class="smart-ad-unit w-full text-center overflow-hidden transition-all duration-500 sticky top-24">
                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5449371042798610" data-ad-slot="9264203071" data-ad-format="auto" data-full-width-responsive="true"></ins>
                <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>
        </aside>

    </main>

    <sv-footer base-path=".."></sv-footer>

    <script>
        let expenses = JSON.parse(localStorage.getItem('sv_budget_items')) || [
            { id: Date.now(), desc: 'Initial Example', cat: 'Software', cost: 1200 }
        ];

        function save() {
            localStorage.setItem('sv_budget_items', JSON.stringify(expenses));
            localStorage.setItem('sv_budget_limit', document.getElementById('projectLimit').value);
        }

        function addItem() {
            expenses.push({ id: Date.now(), desc: '', cat: 'Other', cost: 0 });
            render();
        }

        function deleteItem(id) {
            expenses = expenses.filter(e => e.id !== id);
            render();
        }

        function updateItem(id, field, value) {
            const item = expenses.find(e => e.id === id);
            if (item) {
                item[field] = field === 'cost' ? parseFloat(value) || 0 : value;
                save();
                updateCalculations();
            }
        }

        function updateCalculations() {
            const limit = parseFloat(document.getElementById('projectLimit').value) || 0;
            const spent = expenses.reduce((sum, e) => sum + e.cost, 0);
            const remaining = limit - spent;

            document.getElementById('totalBudget').innerText = `₹${limit.toLocaleString()}`;
            document.getElementById('totalSpent').innerText = `₹${spent.toLocaleString()}`;
            document.getElementById('remainingBudget').innerText = `₹${remaining.toLocaleString()}`;
            
            const remainingEl = document.getElementById('remainingBudget');
            if (remaining < 0) {
                remainingEl.classList.replace('text-emerald-400', 'text-red-500');
            } else {
                remainingEl.classList.replace('text-red-500', 'text-emerald-400');
            }
            save();
        }

        function render() {
            const tbody = document.getElementById('expenseList');
            tbody.innerHTML = '';
            expenses.forEach(e => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-800/30 transition-colors";
                tr.innerHTML = `
                    <td class="px-6 py-4"><input type="text" value="${e.desc}" placeholder="Expense name..." oninput="updateItem(${e.id}, 'desc', this.value)" class="bg-transparent border-none focus:ring-0 text-sm w-full text-slate-300"></td>
                    <td class="px-6 py-4">
                        <select onchange="updateItem(${e.id}, 'cat', this.value)" class="bg-slate-800 text-[10px] uppercase font-bold border-none rounded px-2 py-1 text-slate-400 focus:ring-0">
                            <option value="Software" ${e.cat === 'Software' ? 'selected' : ''}>Software</option>
                            <option value="Labor" ${e.cat === 'Labor' ? 'selected' : ''}>Labor</option>
                            <option value="Marketing" ${e.cat === 'Marketing' ? 'selected' : ''}>Marketing</option>
                            <option value="Other" ${e.cat === 'Other' ? 'selected' : ''}>Other</option>
                        </select>
                    </td>
                    <td class="px-6 py-4 text-right"><input type="number" value="${e.cost}" oninput="updateItem(${e.id}, 'cost', this.value)" class="bg-transparent border-none focus:ring-0 text-sm text-right font-mono w-24 text-white"></td>
                    <td class="px-6 py-4 text-right"><button onclick="deleteItem(${e.id})" class="text-slate-600 hover:text-red-500 transition-colors"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button></td>
                `;
                tbody.appendChild(tr);
            });
            updateCalculations();
        }

        // ARCHITECT: Advanced PDF Preparation
        function prepareAndPrint() {
            // 1. Sync data to the print-only container
            document.getElementById('p-date').innerText = new Date().toLocaleDateString('en-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('p-total').innerText = document.getElementById('totalBudget').innerText;
            document.getElementById('p-spent').innerText = document.getElementById('totalSpent').innerText;
            document.getElementById('p-remain').innerText = document.getElementById('remainingBudget').innerText;

            const pList = document.getElementById('print-list');
            pList.innerHTML = '';
            expenses.forEach(e => {
                pList.innerHTML += `
                    <tr>
                        <td style="font-weight: 500;">${e.desc || 'Unnamed Item'}</td>
                        <td><span style="background: #f1f5f9; padding: 2px 6px; border-radius: 4px; font-size: 10px;">${e.cat.toUpperCase()}</span></td>
                        <td style="text-align: right; font-family: monospace;">₹${e.cost.toLocaleString()}</td>
                    </tr>
                `;
            });

            // 2. Open Print Dialog
            window.print();
        }

        function exportToCSV() {
            if (expenses.length === 0) { alert("No data to export."); return; }
            let csv = "Item Description,Category,Cost (INR)\n";
            expenses.forEach(e => { csv += `"${e.desc.replace(/"/g, '""')}",${e.cat},${e.cost}\n`; });
            csv += `\nTOTAL SPENT,,${expenses.reduce((sum, e) => sum + e.cost, 0)}`;
            const link = document.createElement("a");
            link.setAttribute("href", encodeURI("data:text/csv;charset=utf-8," + csv));
            link.setAttribute("download", `Budget_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function clearAll() { if(confirm("Are you sure? This will delete all saved budget data.")) { expenses = []; render(); } }

        window.onload = () => {
            const savedLimit = localStorage.getItem('sv_budget_limit');
            if (savedLimit) document.getElementById('projectLimit').value = savedLimit;
            render();
        };
    </script>
</body>
</html>
