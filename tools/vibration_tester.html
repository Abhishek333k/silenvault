<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haptic & Vibration Tester | SilenVault</title>
    <meta name="description" content="Test your smartphone's haptic motor. Run vibration diagnostics, heartbeat pulses, and SOS patterns directly in your browser.">
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5449371042798610" crossorigin="anonymous"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="../assets/js/layout.js" defer></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #f8fafc; overflow-x: hidden; }
        .glass-panel { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(51, 65, 85, 0.5); }
        .mono { font-family: 'Fira Code', monospace; }

        /* Haptic Visualizer */
        .haptic-zone {
            position: relative; width: 200px; height: 200px; margin: 0 auto;
            display: flex; align-items: center; justify-content: center;
        }
        
        .phone-mockup {
            width: 80px; height: 160px; border: 4px solid #334155; border-radius: 16px;
            background: linear-gradient(135deg, #0f172a, #020617); position: relative;
            z-index: 10; box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            display: flex; align-items: center; justify-content: center;
        }
        
        .phone-mockup::before {
            content: ''; position: absolute; top: 8px; left: 50%; transform: translateX(-50%);
            width: 24px; height: 4px; background: #334155; border-radius: 2px;
        }

        /* Vibration Rings */
        .vibe-ring {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 100%; height: 100%; border-radius: 50%; border: 2px solid #a855f7;
            opacity: 0; pointer-events: none;
        }

        /* Active Animation Classes */
        .is-vibrating .phone-mockup {
            animation: hardware-shake 0.05s infinite alternate;
            border-color: #a855f7; box-shadow: 0 0 20px rgba(168, 85, 247, 0.6);
        }
        .is-vibrating .vibe-ring { animation: ripple 0.6s infinite ease-out; }

        @keyframes hardware-shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        @keyframes ripple {
            0% { width: 80px; height: 160px; opacity: 0.8; border-radius: 16px; }
            100% { width: 250px; height: 350px; opacity: 0; border-radius: 50%; }
        }

        .preset-btn {
            background: #0f172a; border: 1px solid #1e293b; color: #94a3b8;
            padding: 16px; border-radius: 12px; font-weight: bold; font-size: 14px;
            transition: all 0.2s; text-align: left; display: flex; flex-direction: column; gap: 4px;
        }
        .preset-btn:hover { background: #1e293b; color: #f8fafc; border-color: #334155; }
        .preset-btn.active {
            background: rgba(168, 85, 247, 0.1); border-color: #a855f7;
            color: #a855f7; box-shadow: 0 0 15px rgba(168, 85, 247, 0.2);
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <sv-header base-path=".."></sv-header>

    <main class="flex-1 max-w-[1200px] mx-auto w-full px-4 py-8 flex flex-col gap-6">
        
        <div class="flex flex-col md:flex-row items-center justify-between gap-6 mb-2">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold text-white tracking-tight">
                    Haptic <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500">Diagnostics</span>
                </h1>
                <p class="text-sm text-slate-400 mt-1">Verify smartphone vibration motors and haptic feedback loops.</p>
            </div>
            
            <button onclick="stopVibration()" class="bg-rose-600 hover:bg-rose-500 text-white text-sm font-bold px-6 py-3 rounded-xl transition-all shadow-[0_0_15px_rgba(225,29,72,0.4)] flex items-center gap-2 shrink-0 hidden" id="btn-stop">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"/></svg>
                Force Stop
            </button>
        </div>

        <div id="desktop-warning" class="hidden bg-amber-500/10 border border-amber-500/50 rounded-xl p-4 flex items-start gap-4">
            <svg class="w-6 h-6 text-amber-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            <div>
                <h3 class="text-amber-400 font-bold mb-1">Desktop Device Detected</h3>
                <p class="text-sm text-slate-300">Desktop PCs and Macs do not have physical vibration motors. This tool is designed to be used on smartphones and tablets. The visualizer will still run, but you will not feel physical feedback.</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <div class="lg:col-span-1 glass-panel p-8 rounded-3xl border-slate-700 shadow-2xl flex flex-col items-center justify-center min-h-[350px]">
                <h2 class="text-sm font-bold text-slate-300 uppercase tracking-widest border-b border-slate-800 pb-2 w-full text-center mb-10">Hardware Sync</h2>
                
                <div id="haptic-zone" class="haptic-zone">
                    <div class="vibe-ring"></div>
                    <div class="vibe-ring" style="animation-delay: 0.2s"></div>
                    <div class="phone-mockup">
                        <svg class="w-8 h-8 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                    </div>
                </div>

                <div class="mt-12 text-center">
                    <span class="block text-[10px] font-bold text-slate-500 uppercase mb-1">Status</span>
                    <span id="status-text" class="text-lg font-bold text-slate-400 mono">Idle</span>
                </div>
            </div>

            <div class="lg:col-span-2 flex flex-col gap-6">
                
                <div class="glass-panel p-6 rounded-3xl border-slate-700">
                    <h2 class="text-sm font-bold text-slate-300 uppercase tracking-widest border-b border-slate-800 pb-2 mb-4">Diagnostic Patterns</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button onclick="playPattern('short', [200])" id="btn-short" class="preset-btn">
                            <span class="text-white">Quick Pulse</span>
                            <span class="text-[10px] mono text-slate-500">200ms</span>
                        </button>
                        
                        <button onclick="playPattern('long', [1000])" id="btn-long" class="preset-btn">
                            <span class="text-white">Continuous Burn</span>
                            <span class="text-[10px] mono text-slate-500">1000ms</span>
                        </button>
                        
                        <button onclick="playPattern('heartbeat', [100, 100, 200, 100, 100, 400, 100, 100, 200])" id="btn-heartbeat" class="preset-btn">
                            <span class="text-white">Heartbeat</span>
                            <span class="text-[10px] mono text-slate-500">Double tap sequence</span>
                        </button>
                        
                        <button onclick="playPattern('sos', [100, 100, 100, 100, 100, 300, 300, 100, 300, 100, 300, 300, 100, 100, 100, 100, 100])" id="btn-sos" class="preset-btn">
                            <span class="text-rose-400 font-bold">SOS (Emergency)</span>
                            <span class="text-[10px] mono text-slate-500">... - - - ...</span>
                        </button>
                    </div>
                </div>

                <div class="glass-panel p-6 rounded-3xl border-slate-700 flex-1">
                    <h2 class="text-sm font-bold text-slate-300 uppercase tracking-widest border-b border-slate-800 pb-2 mb-4">Custom Duration</h2>
                    
                    <div class="flex flex-col gap-4">
                        <div class="flex justify-between items-center">
                            <span class="text-xs font-bold text-slate-400">Vibration Length</span>
                            <span id="custom-val" class="text-sm font-bold text-purple-400 mono">500 ms</span>
                        </div>
                        <input type="range" id="custom-slider" min="50" max="3000" step="50" value="500" oninput="updateCustomSlider()" class="w-full accent-purple-500 bg-slate-800 h-2 rounded-lg appearance-none cursor-pointer">
                        
                        <button onclick="playCustom()" class="mt-2 w-full bg-slate-800 hover:bg-purple-600 text-white font-bold py-3 rounded-xl transition-colors border border-slate-700 hover:border-purple-500">
                            Test Custom Length
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <div class="grid lg:grid-cols-3 gap-8 mt-4">
            <div class="lg:col-span-2 glass-panel p-8 rounded-2xl border-slate-800 prose prose-invert max-w-none">
                <h2 class="text-xl font-bold text-white mb-4">Why isn't my phone vibrating?</h2>
                <ul class="text-sm text-slate-400 leading-relaxed space-y-3 m-0 p-0 list-none">
                    <li><strong class="text-slate-200">1. Battery Saver Mode:</strong> Both iOS and Android automatically disable the web vibration API if your phone is in "Low Power Mode" to conserve battery. Plug your phone in or disable the setting.</li>
                    <li><strong class="text-slate-200">2. iOS Permissions:</strong> Apple is incredibly strict with vibrations. On iPhones, vibrations will <strong>only</strong> fire as a direct response to a physical screen tap. It cannot happen automatically in the background. Ensure "System Haptics" is enabled in your iPhone's Sound & Haptics settings.</li>
                    <li><strong class="text-slate-200">3. Hardware Failure:</strong> If you have checked your OS settings and battery modes, and the digital phone on the screen is animating but your physical phone is completely still, your internal Taptic Engine/Vibration Motor is physically damaged.</li>
                </ul>
            </div>

            <div class="space-y-6">
                <div id="sidebar-ad-wrapper" class="hidden opacity-0 transition-opacity duration-1000">
                    <aside class="smart-ad-unit bg-slate-900/50 border border-slate-800 rounded-2xl flex flex-col items-center justify-center p-4 min-h-[250px]">
                        <span class="text-[10px] uppercase tracking-widest text-slate-600 block mb-2 pointer-events-none">Sponsored</span>
                        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5449371042798610" data-ad-slot="7594122081" data-ad-format="auto" data-full-width-responsive="true"></ins>
                        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
                    </aside>
                </div>
            </div>
        </div>

    </main>

    <sv-footer base-path=".."></sv-footer>

    <script>
        // DOM Elements
        const hapticZone = document.getElementById('haptic-zone');
        const statusText = document.getElementById('status-text');
        const btnStop = document.getElementById('btn-stop');
        const customSlider = document.getElementById('custom-slider');
        const customVal = document.getElementById('custom-val');
        const desktopWarning = document.getElementById('desktop-warning');

        let vibeTimeout;

        // Check if device is likely a mobile/tablet capable of vibration
        window.onload = () => {
            monitorAds();
            // A basic check: if it's not a touchscreen device, it likely has no haptic motor.
            if (!('ontouchstart' in window) && navigator.maxTouchPoints === 0) {
                desktopWarning.classList.remove('hidden');
            }
        };

        function updateCustomSlider() {
            customVal.innerText = `${customSlider.value} ms`;
        }

        function playCustom() {
            const val = parseInt(customSlider.value);
            playPattern('custom', [val]);
        }

        function playPattern(id, pattern) {
            // Reset previous
            clearTimeout(vibeTimeout);
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            
            // Highlight current if it's a preset
            const btn = document.getElementById(`btn-${id}`);
            if (btn) btn.classList.add('active');

            // Fire Hardware API
            if ("vibrate" in navigator) {
                navigator.vibrate(pattern);
            } else {
                console.warn("Vibration API not supported on this browser.");
            }

            // Calculate total duration of the pattern array
            const totalDuration = pattern.reduce((a, b) => a + b, 0);

            // Sync Visual UI
            hapticZone.classList.add('is-vibrating');
            statusText.innerText = "Vibrating...";
            statusText.className = "text-lg font-bold text-purple-400 mono";
            btnStop.classList.remove('hidden');

            // Stop visual sync when hardware stops
            vibeTimeout = setTimeout(() => {
                stopVisuals();
            }, totalDuration);
        }

        function stopVibration() {
            if ("vibrate" in navigator) {
                navigator.vibrate(0); // Passing 0 stops current vibration
            }
            stopVisuals();
        }

        function stopVisuals() {
            clearTimeout(vibeTimeout);
            hapticZone.classList.remove('is-vibrating');
            statusText.innerText = "Idle";
            statusText.className = "text-lg font-bold text-slate-400 mono";
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            btnStop.classList.add('hidden');
        }

        // Ad-Sensing Logic
        function monitorAds() {
            const adSlot = document.querySelector('#sidebar-ad-wrapper ins.adsbygoogle');
            const container = document.getElementById('#sidebar-ad-wrapper');
            if (!adSlot) return;

            const observer = new MutationObserver(() => {
                if (adSlot.getAttribute('data-ad-status') === 'filled' || adSlot.innerHTML.includes('iframe')) {
                    container.classList.remove('hidden');
                    setTimeout(() => container.classList.add('opacity-100'), 50);
                    observer.disconnect();
                }
            });
            observer.observe(adSlot, { attributes: true, childList: true });
        }
    </script>
</body>
</html>
