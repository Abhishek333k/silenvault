<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tone Generator & Water Ejector | SilenVault</title>
    <meta name="description" content="Generate pure audio frequencies from 1Hz to 20,000Hz. Test speaker range or use the Water Ejector macro to clear smartphone speakers.">
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5449371042798610" crossorigin="anonymous"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="../assets/js/layout.js" defer></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #f8fafc; overflow-x: hidden; }
        .glass-panel { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(51, 65, 85, 0.5); }
        .mono { font-family: 'Fira Code', monospace; }
        .data-box { background: #020617; border: 1px solid #1e293b; border-radius: 0.75rem; padding: 1rem; position: relative; overflow: hidden; }

        /* Custom Range Sliders */
        input[type=range] {
            -webkit-appearance: none; width: 100%; background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 24px; width: 24px; border-radius: 50%;
            background: #3b82f6; cursor: pointer; margin-top: -8px;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.8); transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:active { transform: scale(1.2); }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 8px; cursor: pointer; background: #1e293b;
            border-radius: 4px; border: 1px solid #334155;
        }
        input[type=range]:focus { outline: none; }

        /* Big Frequency Readout */
        .hz-input {
            background: transparent; border: none; outline: none; text-align: center;
            color: #f8fafc; font-size: 5rem; font-weight: 900; letter-spacing: -2px;
            width: 100%; font-family: 'Fira Code', monospace;
        }

        /* Waveform Selectors */
        .wave-btn {
            background: #0f172a; border: 1px solid #1e293b; color: #64748b;
            padding: 12px; border-radius: 12px; font-weight: bold; font-size: 12px;
            text-transform: uppercase; letter-spacing: 1px; transition: all 0.2s;
            display: flex; flex-direction: column; align-items: center; gap: 8px;
        }
        .wave-btn svg { width: 32px; height: 32px; stroke: currentColor; }
        .wave-btn.active {
            background: rgba(59, 130, 246, 0.1); border-color: #3b82f6;
            color: #3b82f6; box-shadow: 0 0 20px rgba(59, 130, 246, 0.2);
        }

        /* Eject Macro Button Glow */
        .water-glow { animation: water-pulse 2s infinite; }
        @keyframes water-pulse { 0% { box-shadow: 0 0 0 0 rgba(6, 182, 212, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(6, 182, 212, 0); } 100% { box-shadow: 0 0 0 0 rgba(6, 182, 212, 0); } }
        
        .pulse-speaker { animation: shake 0.1s infinite; }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-2px); } 50% { transform: translateX(2px); } 75% { transform: translateX(-2px); } 100% { transform: translateX(0); } }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <sv-header base-path=".."></sv-header>

    <main class="flex-1 max-w-[1200px] mx-auto w-full px-4 py-8 flex flex-col gap-6">
        
        <div class="flex flex-col md:flex-row items-center justify-between gap-6 mb-2">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold text-white tracking-tight">
                    Tone <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-500">Generator</span>
                </h1>
                <p class="text-sm text-slate-400 mt-1">Generate pure frequencies, sweep ranges, and eject water from speakers.</p>
            </div>
            
            <button id="btn-play" onclick="togglePlay()" class="bg-blue-600 hover:bg-blue-500 text-white text-lg font-bold px-8 py-4 rounded-xl transition-all shadow-[0_0_20px_rgba(37,99,235,0.4)] flex items-center gap-3 shrink-0">
                <svg id="icon-play" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                <svg id="icon-pause" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                <span id="play-text">PLAY TONE</span>
            </button>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <div class="lg:col-span-2 glass-panel p-8 rounded-3xl border-slate-700 shadow-2xl flex flex-col gap-8">
                
                <div class="flex flex-col items-center">
                    <span class="text-xs font-bold text-slate-500 uppercase tracking-widest">Frequency Output</span>
                    <div class="flex items-baseline justify-center w-full relative group">
                        <input type="number" id="hz-number" class="hz-input" value="440" min="1" max="20000" onchange="syncFromInput()">
                        <span class="text-2xl font-bold text-slate-500 absolute right-8 bottom-6 pointer-events-none">Hz</span>
                    </div>
                </div>

                <div class="space-y-4">
                    <input type="range" id="hz-slider" min="1" max="20000" value="440" oninput="syncFromSlider()">
                    
                    <div class="flex justify-between items-center bg-slate-900 border border-slate-800 rounded-xl p-2">
                        <button onclick="adjustHz(-10)" class="px-4 py-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded font-bold mono">-10</button>
                        <button onclick="adjustHz(-1)" class="px-4 py-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded font-bold mono">-1</button>
                        <span class="text-[10px] text-slate-600 uppercase font-bold tracking-widest px-4">Fine Tune</span>
                        <button onclick="adjustHz(1)" class="px-4 py-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded font-bold mono">+1</button>
                        <button onclick="adjustHz(10)" class="px-4 py-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded font-bold mono">+10</button>
                    </div>
                </div>

                <div>
                    <span class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-3 text-center">Waveform Profile</span>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <button onclick="setWaveform('sine')" id="btn-sine" class="wave-btn active">
                            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M3 12c3 0 3-6 6-6s3 6 6 6 3 6 6 6 3-6 6-6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            Sine
                        </button>
                        <button onclick="setWaveform('square')" id="btn-square" class="wave-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M3 12h4v-6h6v12h6v-6h2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            Square
                        </button>
                        <button onclick="setWaveform('sawtooth')" id="btn-sawtooth" class="wave-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M3 18l6-12v12l6-12v12l6-12" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            Sawtooth
                        </button>
                        <button onclick="setWaveform('triangle')" id="btn-triangle" class="wave-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M3 12l4-8 8 16 6-12" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            Triangle
                        </button>
                    </div>
                </div>

            </div>

            <div class="flex flex-col gap-6">
                
                <div class="glass-panel p-6 rounded-3xl border-cyan-500/30 bg-cyan-950/10 shadow-[0_0_30px_rgba(6,182,212,0.1)] flex flex-col items-center text-center">
                    <div id="water-icon" class="w-16 h-16 bg-cyan-500/20 text-cyan-400 rounded-full flex items-center justify-center mb-4 border border-cyan-500/50">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
                    </div>
                    <h2 class="text-lg font-bold text-white mb-1">Water Ejector</h2>
                    <p class="text-xs text-slate-400 mb-4">Plays a precise 165Hz pulsating frequency to forcefully push liquid out of speaker grilles.</p>
                    
                    <button onclick="runWaterEject()" id="btn-water" class="w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 rounded-xl transition-all shadow-[0_0_15px_rgba(6,182,212,0.4)] water-glow">
                        Eject Water
                    </button>
                </div>

                <div class="glass-panel p-6 rounded-3xl border-slate-700">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-sm font-bold text-slate-300 uppercase tracking-widest">Master Volume</h2>
                        <span id="vol-display" class="text-xs font-bold text-blue-400 mono">50%</span>
                    </div>
                    <input type="range" id="vol-slider" min="0" max="100" value="50" oninput="updateVolume()">
                </div>

                <div class="glass-panel p-6 rounded-3xl border-slate-700 flex-1">
                    <h2 class="text-sm font-bold text-slate-300 uppercase tracking-widest border-b border-slate-800 pb-2 mb-4">Quick Presets</h2>
                    <div class="space-y-2">
                        <button onclick="setPreset(165)" class="w-full flex justify-between items-center bg-slate-900 hover:bg-slate-800 border border-slate-800 px-4 py-2 rounded-lg text-xs transition-colors">
                            <span class="text-slate-400">Phone Speaker resonance</span>
                            <span class="text-white font-bold mono">165 Hz</span>
                        </button>
                        <button onclick="setPreset(440)" class="w-full flex justify-between items-center bg-slate-900 hover:bg-slate-800 border border-slate-800 px-4 py-2 rounded-lg text-xs transition-colors">
                            <span class="text-slate-400">Tuning Standard (A4)</span>
                            <span class="text-white font-bold mono">440 Hz</span>
                        </button>
                        <button onclick="setPreset(1000)" class="w-full flex justify-between items-center bg-slate-900 hover:bg-slate-800 border border-slate-800 px-4 py-2 rounded-lg text-xs transition-colors">
                            <span class="text-slate-400">Studio Test Beep</span>
                            <span class="text-white font-bold mono">1000 Hz</span>
                        </button>
                        <button onclick="setPreset(10000)" class="w-full flex justify-between items-center bg-slate-900 hover:bg-slate-800 border border-slate-800 px-4 py-2 rounded-lg text-xs transition-colors">
                            <span class="text-slate-400">High Frequency Test</span>
                            <span class="text-white font-bold mono">10 kHz</span>
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <div class="grid lg:grid-cols-3 gap-8 mt-4">
            <div class="lg:col-span-2 glass-panel p-8 rounded-2xl border-slate-800 prose prose-invert max-w-none">
                <h2 class="text-xl font-bold text-white mb-4">How to Use the Tone Generator</h2>
                <ul class="text-sm text-slate-400 leading-relaxed space-y-3 m-0 p-0 list-none">
                    <li><strong class="text-cyan-400">Clearing Water:</strong> Turn your device volume to Maximum. Click the "Eject Water" button. The tool will cycle a powerful 165Hz sine wave designed to vibrate the speaker hardware violently, forcing trapped droplets out of the mesh. Keep your device pointed downwards.</li>
                    <li><strong class="text-slate-200">Testing Audio Gear:</strong> Use the sweeping slider to verify that your headphones or subwoofers are capable of producing low frequencies (20Hz - 60Hz) without rattling or distortion.</li>
                    <li><strong class="text-slate-200">Warning:</strong> High frequencies (10,000Hz+) can be painful and damage hearing or hardware if played at maximum volume. Start with the Master Volume at 50% before proceeding.</li>
                </ul>
            </div>

            <div class="space-y-6">
                <div id="sidebar-ad-wrapper" class="hidden opacity-0 transition-opacity duration-1000">
                    <aside class="smart-ad-unit bg-slate-900/50 border border-slate-800 rounded-2xl flex flex-col items-center justify-center p-4 min-h-[250px]">
                        <span class="text-[10px] uppercase tracking-widest text-slate-600 block mb-2 pointer-events-none">Sponsored</span>
                        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5449371042798610" data-ad-slot="7594122081" data-ad-format="auto" data-full-width-responsive="true"></ins>
                        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
                    </aside>
                </div>
            </div>
        </div>

    </main>

    <sv-footer base-path=".."></sv-footer>

    <script>
        // Web Audio Context Variables
        let audioCtx;
        let oscillator;
        let gainNode;
        let isPlaying = false;
        
        let currentWaveform = 'sine';
        let ejectMacroActive = false;
        let ejectInterval;

        // DOM Elements
        const hzInput = document.getElementById('hz-number');
        const hzSlider = document.getElementById('hz-slider');
        const btnPlay = document.getElementById('btn-play');
        const playText = document.getElementById('play-text');
        const iconPlay = document.getElementById('icon-play');
        const iconPause = document.getElementById('icon-pause');
        const volSlider = document.getElementById('vol-slider');
        const volDisplay = document.getElementById('vol-display');
        const btnWater = document.getElementById('btn-water');
        const waterIcon = document.getElementById('water-icon');

        const waveBtns = {
            'sine': document.getElementById('btn-sine'),
            'square': document.getElementById('btn-square'),
            'sawtooth': document.getElementById('btn-sawtooth'),
            'triangle': document.getElementById('btn-triangle')
        };

        // --- Core Audio Engine ---
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                gainNode = audioCtx.createGain();
                gainNode.connect(audioCtx.destination);
                updateVolume(); // set initial volume
            }
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function togglePlay() {
            if (isPlaying) stopTone();
            else startTone();
        }

        function startTone() {
            initAudio();
            
            // Re-create oscillator (they are single-use nodes in Web Audio)
            oscillator = audioCtx.createOscillator();
            oscillator.type = currentWaveform;
            oscillator.frequency.setValueAtTime(parseFloat(hzInput.value), audioCtx.currentTime);
            oscillator.connect(gainNode);
            oscillator.start();
            
            isPlaying = true;

            // UI Update
            btnPlay.classList.replace('bg-blue-600', 'bg-rose-600');
            btnPlay.classList.replace('hover:bg-blue-500', 'hover:bg-rose-500');
            btnPlay.classList.replace('shadow-[0_0_20px_rgba(37,99,235,0.4)]', 'shadow-[0_0_20px_rgba(225,29,72,0.4)]');
            playText.innerText = "STOP TONE";
            iconPlay.classList.add('hidden');
            iconPause.classList.remove('hidden');
        }

        function stopTone() {
            if (oscillator) {
                oscillator.stop();
                oscillator.disconnect();
                oscillator = null;
            }
            isPlaying = false;
            
            if(ejectMacroActive) stopWaterEject();

            // UI Update
            btnPlay.classList.replace('bg-rose-600', 'bg-blue-600');
            btnPlay.classList.replace('hover:bg-rose-500', 'hover:bg-blue-500');
            btnPlay.classList.replace('shadow-[0_0_20px_rgba(225,29,72,0.4)]', 'shadow-[0_0_20px_rgba(37,99,235,0.4)]');
            playText.innerText = "PLAY TONE";
            iconPlay.classList.remove('hidden');
            iconPause.classList.add('hidden');
        }

        // --- Controls ---
        function updateFrequency(val) {
            // Clamp to bounds
            if(val < 1) val = 1;
            if(val > 20000) val = 20000;
            
            hzInput.value = val;
            hzSlider.value = val;

            if (isPlaying && oscillator && !ejectMacroActive) {
                // Smooth slide the frequency instead of harsh jump
                oscillator.frequency.exponentialRampToValueAtTime(val, audioCtx.currentTime + 0.1);
            }
        }

        function syncFromInput() { updateFrequency(parseFloat(hzInput.value)); }
        function syncFromSlider() { updateFrequency(parseFloat(hzSlider.value)); }
        
        function adjustHz(amount) {
            updateFrequency(parseFloat(hzInput.value) + amount);
        }

        function setPreset(hz) {
            updateFrequency(hz);
            if(!isPlaying) startTone();
        }

        function setWaveform(type) {
            currentWaveform = type;
            
            // UI Toggle
            Object.values(waveBtns).forEach(btn => btn.classList.remove('active'));
            waveBtns[type].classList.add('active');

            if (isPlaying && oscillator && !ejectMacroActive) {
                oscillator.type = type;
            }
        }

        function updateVolume() {
            const vol = volSlider.value;
            volDisplay.innerText = `${vol}%`;
            if (gainNode) {
                // Convert linear percentage to an exponential curve for human hearing
                const fraction = parseInt(vol) / 100;
                gainNode.gain.setValueAtTime(fraction * fraction, audioCtx.currentTime); 
            }
        }

        // --- Water Eject Macro ---
        function runWaterEject() {
            if (ejectMacroActive) {
                stopTone();
                return;
            }

            ejectMacroActive = true;
            setWaveform('sine');
            updateFrequency(165); // Standard physical resonance for water clearing
            
            // Override volume to max
            volSlider.value = 100;
            updateVolume();

            // Start base tone
            if(!isPlaying) startTone();

            // UI
            btnWater.innerText = "STOP EJECTOR";
            btnWater.classList.replace('bg-cyan-600', 'bg-rose-600');
            btnWater.classList.replace('hover:bg-cyan-500', 'hover:bg-rose-500');
            btnWater.classList.replace('shadow-[0_0_15px_rgba(6,182,212,0.4)]', 'shadow-[0_0_15px_rgba(225,29,72,0.4)]');
            btnWater.classList.remove('water-glow');
            waterIcon.classList.add('pulse-speaker', 'text-rose-400');
            waterIcon.classList.replace('bg-cyan-500/20', 'bg-rose-500/20');
            waterIcon.classList.replace('border-cyan-500/50', 'border-rose-500/50');

            // Pulse Logic: Modulate gain to create physical air bursts
            let pulseUp = true;
            ejectInterval = setInterval(() => {
                if(!gainNode) return;
                if(pulseUp) gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                else gainNode.gain.exponentialRampToValueAtTime(1.0, audioCtx.currentTime + 0.1);
                pulseUp = !pulseUp;
            }, 150);

            // Auto-stop after 10 seconds
            setTimeout(() => { if(ejectMacroActive) stopTone(); }, 10000);
        }

        function stopWaterEject() {
            ejectMacroActive = false;
            clearInterval(ejectInterval);
            
            btnWater.innerText = "Eject Water";
            btnWater.classList.replace('bg-rose-600', 'bg-cyan-600');
            btnWater.classList.replace('hover:bg-rose-500', 'hover:bg-cyan-500');
            btnWater.classList.replace('shadow-[0_0_15px_rgba(225,29,72,0.4)]', 'shadow-[0_0_15px_rgba(6,182,212,0.4)]');
            btnWater.classList.add('water-glow');
            waterIcon.classList.remove('pulse-speaker', 'text-rose-400');
            waterIcon.classList.replace('bg-rose-500/20', 'bg-cyan-500/20');
            waterIcon.classList.replace('border-rose-500/50', 'border-cyan-500/50');
            
            // Restore actual slider volume
            updateVolume();
        }

        // Ad-Sensing Logic
        function monitorAds() {
            const adSlot = document.querySelector('#sidebar-ad-wrapper ins.adsbygoogle');
            const container = document.getElementById('#sidebar-ad-wrapper');
            if (!adSlot) return;

            const observer = new MutationObserver(() => {
                if (adSlot.getAttribute('data-ad-status') === 'filled' || adSlot.innerHTML.includes('iframe')) {
                    container.classList.remove('hidden');
                    setTimeout(() => container.classList.add('opacity-100'), 50);
                    observer.disconnect();
                }
            });
            observer.observe(adSlot, { attributes: true, childList: true });
        }

        window.onload = monitorAds;
    </script>
</body>
</html>
