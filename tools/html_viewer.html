<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure HTML Viewer & JS Sandbox | SilenVault Architect</title>
    <meta name="description" content="Test HTML, CSS, and JavaScript in a secure, local-first sandbox environment. Zero cloud tracking, instant live preview, and XSS protection for developers.">
    <link rel="icon" type="image/png" href="../assets/img/SILENVAULT_LOGO.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="../assets/js/layout.js" defer></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #f8fafc; }
        .editor-font { font-family: 'Fira Code', monospace; line-height: 1.6; }
        .ad-placeholder { background: repeating-linear-gradient(45deg, #1e293b, #1e293b 10px, #334155 10px, #334155 20px); display: flex; align-items: center; justify-content: center; color: #94a3b8; font-size: 0.75rem; text-transform: uppercase; border: 1px dashed #475569; border-radius: 0.5rem; }
        .line-numbers { font-family: 'Fira Code', monospace; line-height: 1.6; text-align: right; color: #475569; background-color: #0f172a; user-select: none; padding: 1.5rem 0.5rem; }
        #editor { resize: none; background: transparent; outline: none; }
        .tab-active { border-bottom: 2px solid #3b82f6; color: #60a5fa; background: rgba(59, 130, 246, 0.1); }
        .tab-inactive { color: #94a3b8; }
        .tab-inactive:hover { color: #e2e8f0; background: rgba(255, 255, 255, 0.05); }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        .prose-custom h2 { color: #f8fafc; font-weight: 700; font-size: 1.875rem; margin-top: 2rem; margin-bottom: 1rem; }
        .prose-custom h3 { color: #cbd5e1; font-weight: 600; font-size: 1.25rem; margin-top: 1.5rem; margin-bottom: 0.75rem; }
        .prose-custom p { color: #94a3b8; line-height: 1.75; margin-bottom: 1.25rem; }
        .prose-custom ul { color: #94a3b8; list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1.25rem; }
        .prose-custom li { margin-bottom: 0.5rem; }
    </style>
</head>
<body class="min-h-screen flex flex-col selection:bg-blue-500/30 selection:text-blue-200">

    <sv-header base-path=".."></sv-header>

    <div class="max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 pt-8 pb-4">
        <h1 class="text-3xl font-bold text-white mb-2">Architect HTML Console</h1>
        <p class="text-slate-400 text-sm mb-6">Pro Edition: Local-First Sandbox & Code Renderer</p>
        <div class="ad-placeholder w-full h-24 mb-6">Leaderboard Ad Block (728x90)</div>
    </div>

    <main class="max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 mb-16">
        <div class="flex flex-col xl:flex-row gap-6 h-[70vh] min-h-[500px]">
            <section class="flex-1 flex flex-col border border-slate-700 rounded-xl overflow-hidden relative shadow-2xl bg-slate-900 z-10">
                <div class="flex items-center justify-between bg-slate-950 border-b border-slate-800 shrink-0 pr-4">
                    <div class="flex w-2/3">
                        <button onclick="switchTab('html')" id="tab-html" class="tab-active flex-1 py-3 text-xs font-mono font-medium transition-colors">index.html</button>
                        <button onclick="switchTab('css')" id="tab-css" class="tab-inactive flex-1 py-3 text-xs font-mono font-medium transition-colors">style.css</button>
                        <button onclick="switchTab('js')" id="tab-js" class="tab-inactive flex-1 py-3 text-xs font-mono font-medium transition-colors">script.js</button>
                    </div>
                    <div class="flex gap-2">
                        <button id="btn-export" class="bg-blue-600/20 hover:bg-blue-600/40 text-blue-400 text-[10px] font-bold px-3 py-1.5 rounded uppercase tracking-wider transition-colors">Export</button>
                        <button id="btn-clear" class="text-slate-500 hover:text-red-400 text-[10px] font-bold px-2 uppercase tracking-wider transition-colors">Reset</button>
                    </div>
                </div>

                <div class="flex-1 flex relative overflow-hidden bg-[#0b1120]">
                    <div id="line-numbers" class="line-numbers w-12 shrink-0 overflow-hidden border-r border-slate-800 font-mono text-xs">1</div>
                    <textarea id="editor" class="flex-1 p-6 editor-font text-blue-100 text-sm whitespace-pre" spellcheck="false" placeholder=""></textarea>
                    <div id="char-count" class="absolute bottom-2 right-4 text-[10px] text-slate-600 font-mono bg-slate-900/80 px-2 rounded pointer-events-none">0 chars</div>
                    <div id="status-indicator" class="absolute bottom-2 right-20 text-[10px] text-emerald-500 font-mono bg-slate-900/80 px-2 rounded opacity-0 transition-opacity pointer-events-none">Compiling...</div>
                </div>
            </section>

            <section class="flex-1 flex flex-col border border-slate-700 rounded-xl overflow-hidden bg-white shadow-2xl relative z-10">
                <div class="bg-slate-100 px-4 py-3 text-[10px] font-bold text-slate-500 uppercase border-b border-slate-200 flex justify-between items-center shrink-0">
                    <span>Live Preview</span>
                    <span class="text-emerald-600 flex items-center gap-1" title="Code executes locally. No data is transmitted.">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                        Isolated Sandbox
                    </span>
                </div>
                <iframe id="preview" class="flex-1 w-full h-full border-none bg-white" sandbox="allow-scripts allow-modals allow-forms"></iframe>
            </section>
        </div>
    </main>

    <div class="max-w-4xl mx-auto w-full px-4 mb-12">
        <div class="ad-placeholder w-full h-[250px]">In-Article Ad Block</div>
    </div>

    <article class="max-w-4xl mx-auto w-full px-4 sm:px-6 lg:px-8 mb-20 prose-custom">
        <h2>The Ultimate Secure HTML Viewer</h2>
        <p>In modern web development, testing code snippets requires speed and security. The <strong>SilenVault HTML Viewer</strong> is a robust, zero-latency sandbox.</p>
        <h3>Why Local-First?</h3>
        <ul>
            <li><strong>Zero Data Exfiltration:</strong> Your logic remains on your machine.</li>
            <li><strong>Instant Compilation:</strong> DOM rendering in under 300ms.</li>
        </ul>
    </article>

    <sv-footer base-path=".."></sv-footer>

    <script>
        const codeStore = {
            html: `\n<div class="invoice-box">\n  <h1>Business Invoice Template</h1>\n  <p>Start editing to generate your custom layout.</p>\n  <button id="demo">Test Logic</button>\n</div>`,
            css: `body {\n  font-family: 'Inter', sans-serif;\n  padding: 2rem;\n  background: #f8fafc;\n}\n.invoice-box {\n  background: white;\n  padding: 2rem;\n  border-radius: 8px;\n  box-shadow: 0 4px 6px rgba(0,0,0,0.05);\n}\nh1 { color: #2563eb; margin-top: 0; }`,
            js: `document.getElementById('demo').addEventListener('click', () => {\n  alert('Logic processor engaged.');\n});`
        };
        let activeTab = 'html';
        let timeoutId = null;
        let lastLineCount = 0;
        const els = {
            editor: document.getElementById('editor'),
            lines: document.getElementById('line-numbers'),
            preview: document.getElementById('preview'),
            status: document.getElementById('status-indicator'),
            charCount: document.getElementById('char-count'),
            tabs: { html: document.getElementById('tab-html'), css: document.getElementById('tab-css'), js: document.getElementById('tab-js') }
        };

        function switchTab(newTab) {
            codeStore[activeTab] = els.editor.value;
            els.tabs[activeTab].classList.replace('tab-active', 'tab-inactive');
            els.tabs[newTab].classList.replace('tab-inactive', 'tab-active');
            activeTab = newTab;
            els.editor.value = codeStore[activeTab];
            updateLineNumbers(true);
            els.editor.focus();
        }

        function updateLineNumbers(force = false) {
            const lines = els.editor.value.split('\n').length;
            if (lines !== lastLineCount || force) {
                els.lines.innerHTML = Array(lines).fill(0).map((_, i) => i + 1).join('<br>');
                lastLineCount = lines;
            }
        }
        function syncScroll() { els.lines.scrollTop = els.editor.scrollTop; }
        function compile() {
            codeStore[activeTab] = els.editor.value;
            els.status.style.opacity = '1';
            clearTimeout(timeoutId);
            timeoutId = setTimeout(() => {
                const html = codeStore.html;
                const css = `<style>${codeStore.css}</style>`;
                const js = `<script>${codeStore.js.replace(/<\/script>/gi, '<\\/script>')}<\/script>`; 
                let full = html.includes('<html') ? html : `<!DOCTYPE html><html><head>${css}</head><body>${html}${js}</body></html>`;
                els.preview.srcdoc = full;
                els.status.style.opacity = '0';
            }, 300);
            els.charCount.innerText = `${els.editor.value.length} chars`;
        }

        function downloadProject() {
            codeStore[activeTab] = els.editor.value; 
            const full = `<!DOCTYPE html><html><head><style>${codeStore.css}</style></head><body>${codeStore.html}<script>${codeStore.js.replace(/<\/script>/gi, '<\\/script>')}<\/script></body></html>`;
            const blob = new Blob([full], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = `architect_export.html`; a.click();
            URL.revokeObjectURL(url);
        }
        
        els.editor.addEventListener('input', () => { updateLineNumbers(); compile(); });
        els.editor.addEventListener('scroll', syncScroll);
        els.editor.addEventListener('keydown', function(e) {
            if (e.key === 'Tab') { e.preventDefault(); this.setRangeText('  ', this.selectionStart, this.selectionEnd, 'end'); updateLineNumbers(); compile(); }
        });
        document.getElementById('btn-export').addEventListener('click', downloadProject);
        document.getElementById('btn-clear').addEventListener('click', () => { if(confirm('Purge session?')) location.reload(); });
        window.onload = () => { els.editor.value = codeStore.html; updateLineNumbers(true); compile(); };
    </script>
</body>
</html>
