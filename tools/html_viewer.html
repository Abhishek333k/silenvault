<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architect Pro | SilenVault IDE</title>
    <meta name="description" content="Professional sandboxed HTML/CSS/JS editor. Real-time compilation and secure local-first development.">
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5449371042798610" crossorigin="anonymous"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
    
    <script src="../assets/js/layout.js" defer></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #e2e8f0; overflow-x: hidden; }
        .glass-panel { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(51, 65, 85, 0.5); }
        
        /* IDE Specific Constraints */
        .editor-container { height: calc(100vh - 200px); min-height: 600px; }
        
        /* Custom Scrollbar for IDE feel */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        #editor-wrapper { position: relative; background: #0b1120; height: 100%; border-radius: 0 0 0 1rem; }

        #highlight-overlay { pointer-events: none; user-select: none; position: absolute; inset: 0; overflow: hidden; }

        /* ARCHITECT FIX: Mathematical Sync between Textarea and Pre */
        #code-input, #highlight-overlay pre, #highlight-code {
            font-family: 'Fira Code', monospace !important;
            font-size: 14px !important;
            line-height: 1.6 !important;
            tab-size: 4 !important;
        }

        #highlight-overlay pre { margin: 0 !important; padding: 20px !important; height: 100%; overflow: auto; white-space: pre; background: transparent !important; }

        #code-input {
            color: transparent !important;
            caret-color: #f8fafc !important;
            background: transparent;
            resize: none;
            outline: none;
            position: absolute;
            inset: 0;
            z-index: 10;
            padding: 20px !important;
            margin: 0 !important;
            border: none !important;
            width: 100%; height: 100%;
        }

        #code-input::selection { background: rgba(59, 130, 246, 0.3); }

        .line-numbers {
            background: #020617;
            border-right: 1px solid #1e293b;
            color: #475569;
            padding: 20px 12px;
            text-align: right;
            user-select: none;
            font-family: 'Fira Code', monospace;
            font-size: 14px;
            line-height: 1.6;
            min-width: 50px;
            border-radius: 1rem 0 0 0;
        }

        /* Tabs UI */
        .tab { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); border-bottom: 2px solid transparent; }
        .tab-active { background: #0f172a; color: #3b82f6; border-bottom-color: #3b82f6; }
        .tab-inactive { color: #64748b; }
        .tab-inactive:hover { color: #e2e8f0; background: rgba(255,255,255,0.05); }

        @media (max-width: 768px) {
            .editor-container { flex-direction: column; height: auto; }
            .editor-pane, .preview-pane { width: 100% !important; height: 50vh; }
            #editor-wrapper, .line-numbers, .preview-pane { border-radius: 0; }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <sv-header base-path=".."></sv-header>

    <main class="flex-1 w-full max-w-7xl mx-auto px-4 py-8 flex flex-col gap-8">
        
        <div class="text-center mb-2">
            <h1 class="text-3xl md:text-5xl font-bold text-white mb-4 tracking-tight">
                Architect <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-500">Pro IDE</span>
            </h1>
            <p class="text-slate-400 max-w-lg mx-auto">
                Secure local-first development. Code executes entirely within your browser's RAM.
            </p>
        </div>

        <div class="glass-panel rounded-2xl flex flex-col overflow-hidden border border-slate-700 shadow-2xl">
            
            <div class="h-14 bg-slate-900 border-b border-slate-800 flex items-center justify-between px-4 z-40">
                <div class="flex items-center gap-1 h-full">
                    <button onclick="switchTab('html')" id="tab-html" class="tab tab-active h-full px-4 text-xs font-bold flex items-center gap-2">
                        <svg class="w-3.5 h-3.5 text-orange-500" fill="currentColor" viewBox="0 0 24 24"><path d="M1.5 22L0 2h24l-1.5 20L12 24l-10.5-2zM3 4l1.2 15.5L12 21.3l7.8-1.8L21 4H3z"/></svg>
                        index.html
                    </button>
                    <button onclick="switchTab('css')" id="tab-css" class="tab tab-inactive h-full px-4 text-xs font-bold flex items-center gap-2">
                        <svg class="w-3.5 h-3.5 text-blue-500" fill="currentColor" viewBox="0 0 24 24"><path d="M1.5 22L0 2h24l-1.5 20L12 24l-10.5-2zM3 4l1.2 15.5L12 21.3l7.8-1.8L21 4H3z"/></svg>
                        style.css
                    </button>
                    <button onclick="switchTab('js')" id="tab-js" class="tab tab-inactive h-full px-4 text-xs font-bold flex items-center gap-2">
                        <svg class="w-3.5 h-3.5 text-yellow-500" fill="currentColor" viewBox="0 0 24 24"><path d="M3 3h18v18H3V3zm14.5 13.5v-4h-2v4h2zm-4.5 0v-9h-2v9h2z"/></svg>
                        script.js
                    </button>
                </div>

                <div class="flex items-center gap-4">
                    <div id="save-indicator" class="text-[10px] font-mono text-emerald-500 opacity-0 transition-opacity">Auto-compiled</div>
                    <button onclick="downloadProject()" class="bg-blue-600 hover:bg-blue-500 text-white text-[11px] font-bold px-4 py-2 rounded-lg transition-all shadow-lg shadow-blue-500/20 flex items-center gap-2">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                        Export Zip
                    </button>
                </div>
            </div>

            <div class="flex editor-container">
                <section class="editor-pane w-1/2 flex relative border-r border-slate-800">
                    <div id="line-numbers" class="line-numbers select-none">1</div>
                    <div id="editor-wrapper" class="flex flex-1 overflow-hidden">
                        <div id="highlight-overlay">
                            <pre><code id="highlight-code" class="language-markup"></code></pre>
                        </div>
                        <textarea id="code-input" spellcheck="false" placeholder="Write code here..."></textarea>
                    </div>
                </section>

                <section class="preview-pane w-1/2 flex flex-col bg-white">
                    <div class="bg-slate-100 border-b border-slate-200 px-4 py-2 flex items-center justify-between">
                        <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2">
                            <svg class="w-3 h-3 text-emerald-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                            Live Sandbox
                        </span>
                        <div class="flex gap-1.5">
                            <div class="w-2.5 h-2.5 rounded-full bg-slate-300"></div>
                            <div class="w-2.5 h-2.5 rounded-full bg-slate-300"></div>
                            <div class="w-2.5 h-2.5 rounded-full bg-slate-300"></div>
                        </div>
                    </div>
                    <iframe id="preview-frame" class="flex-1 w-full h-full border-none" sandbox="allow-scripts allow-modals"></iframe>
                </section>
            </div>
        </div>

        <div class="grid lg:grid-cols-3 gap-8 mt-4">
            <div class="lg:col-span-2 glass-panel p-8 rounded-2xl border-slate-800">
                <h2 class="text-2xl font-bold text-white mb-4">HTML Online Editor & Compiler</h2>
                <p class="text-sm text-slate-400 leading-relaxed mb-8">
                    Write, run, and share HTML code online using SilenVault's Pro Architect. This is a local-first environment, meaning your source code is processed entirely within your browser. We support HTML5, CSS3, and modern JavaScript (ES6+).
                </p>

                <h3 class="text-lg font-bold text-blue-400 mb-4">Syntax Fundamentals</h3>
                <div class="space-y-3">
                    <details class="bg-slate-900 border border-slate-800 rounded-xl p-4 group" open>
                        <summary class="font-bold text-white cursor-pointer list-none flex justify-between items-center text-sm">
                            Document Structure
                            <svg class="w-4 h-4 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7"/></svg>
                        </summary>
                        <div class="mt-4 text-xs text-slate-400 leading-relaxed">
                            Every HTML document must start with <code class="text-emerald-400 font-mono bg-slate-950 px-1 rounded">&lt;!DOCTYPE html&gt;</code>. 
                            The root element is <code class="text-emerald-400 font-mono bg-slate-950 px-1 rounded">&lt;html&gt;</code>, followed by the <code class="text-emerald-400 font-mono bg-slate-950 px-1 rounded">&lt;head&gt;</code> for metadata and <code class="text-emerald-400 font-mono bg-slate-950 px-1 rounded">&lt;body&gt;</code> for visible content.
                        </div>
                    </details>

                    <details class="bg-slate-900 border border-slate-800 rounded-xl p-4 group">
                        <summary class="font-bold text-white cursor-pointer list-none flex justify-between items-center text-sm">
                            Styling with CSS
                            <svg class="w-4 h-4 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7"/></svg>
                        </summary>
                        <div class="mt-4 text-xs text-slate-400 leading-relaxed">
                            SilenVault's Architect automatically injects code from the <span class="text-blue-400 font-bold">style.css</span> tab into the head of your document. You don't need to manually link the stylesheet; just write your rules and they will apply instantly.
                        </div>
                    </details>

                    <details class="bg-slate-900 border border-slate-800 rounded-xl p-4 group">
                        <summary class="font-bold text-white cursor-pointer list-none flex justify-between items-center text-sm">
                            Interactive JS
                            <svg class="w-4 h-4 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7"/></svg>
                        </summary>
                        <div class="mt-4 text-xs text-slate-400 leading-relaxed">
                            JavaScript written in the <span class="text-yellow-500 font-bold">script.js</span> tab is executed after the DOM has fully loaded. We utilize a secure <code class="font-mono bg-slate-950 px-1 rounded">&lt;iframe sandbox&gt;</code> to ensure your testing environment is isolated from the main site.
                        </div>
                    </details>
                </div>
            </div>

            <aside class="space-y-6">
                <div class="smart-ad-unit w-full text-center overflow-hidden transition-all duration-500 min-h-[250px] bg-slate-900/50 border border-slate-800 rounded-2xl flex flex-col items-center justify-center p-4">
                    <span class="text-[10px] uppercase tracking-widest text-slate-600 block mb-2">Sponsored</span>
                    <ins class="adsbygoogle"
                         style="display:block"
                         data-ad-client="ca-pub-5449371042798610"
                         data-ad-slot="7594122081"
                         data-ad-format="auto"
                         data-full-width-responsive="true"></ins>
                    <script>
                         (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>

                <div class="bg-blue-600/10 border border-blue-500/20 rounded-2xl p-6">
                    <h4 class="text-blue-400 font-bold mb-2 flex items-center gap-2 text-sm">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        Architect Tip
                    </h4>
                    <p class="text-xs text-slate-400 leading-relaxed">
                        Use <code class="font-mono text-emerald-400 bg-slate-900 px-1 rounded">console.log()</code> in the JS tab and open your browser inspector (F12) to see debugging data in real-time.
                    </p>
                </div>
            </aside>
        </div>

    </main>

    <sv-footer base-path=".."></sv-footer>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-emerald-600 text-white px-6 py-3 rounded-full text-sm font-bold shadow-2xl opacity-0 transition-all pointer-events-none translate-y-4 z-50">
        Project Exported Successfully
    </div>

    <script>
        // State Management
        const store = {
            active: 'html',
            html: `\n<div class="hero">\n  <h1>Build Something Great</h1>\n  <p>Your local code sandbox is ready.</p>\n  <button id="mainBtn">Click Me</button>\n</div>`,
            css: `body { \n  background: #f0f4f8;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100vh;\n  margin: 0;\n  font-family: sans-serif;\n}\n.hero {\n  text-align: center;\n  padding: 3rem;\n  background: white;\n  border-radius: 20px;\n  box-shadow: 0 10px 25px rgba(0,0,0,0.1);\n}\nh1 { color: #2563eb; margin: 0; }\np { color: #64748b; }\nbutton {\n  background: #2563eb;\n  color: white;\n  border: none;\n  padding: 10px 24px;\n  border-radius: 8px;\n  cursor: pointer;\n  font-weight: bold;\n}`,
            js: `document.getElementById('mainBtn').addEventListener('click', () => {\n  alert('Architect Pro Initialized!');\n});`
        };

        const els = {
            input: document.getElementById('code-input'),
            highlightCode: document.getElementById('highlight-code'),
            lines: document.getElementById('line-numbers'),
            preview: document.getElementById('preview-frame'),
            saveTag: document.getElementById('save-indicator'),
            toast: document.getElementById('toast')
        };

        let compileTimeout;

        const debounceCompile = () => {
            clearTimeout(compileTimeout);
            els.saveTag.style.opacity = '1';
            compileTimeout = setTimeout(compile, 400);
        };

        function switchTab(tab) {
            store[store.active] = els.input.value;
            document.querySelectorAll('.tab').forEach(t => t.classList.replace('tab-active', 'tab-inactive'));
            document.getElementById(`tab-${tab}`).classList.replace('tab-inactive', 'tab-active');
            store.active = tab;
            els.input.value = store[tab];
            updateHighlight();
            updateLineNumbers();
            els.input.focus();
        }

        function updateLineNumbers() {
            const count = (els.input.value + '\n').split('\n').length - 1;
            els.lines.innerHTML = Array.from({length: Math.max(count, 1)}, (_, i) => i + 1).join('<br>');
        }

        function updateHighlight() {
            let code = (els.input.value || '') + '\n';
            let lang = store.active === 'html' ? 'markup' : store.active;

            els.highlightCode.className = `language-${lang}`;
            els.highlightCode.textContent = code;
            Prism.highlightElement(els.highlightCode);
        }

        function compile() {
            store[store.active] = els.input.value;
            
            const source = `
                <!DOCTYPE html>
                <html>
                    <head>
                        <style>${store.css}</style>
                    </head>
                    <body>
                        ${store.html}
                        <script>${store.js}<\/script>
                    </body>
                </html>
            `;

            const blob = new Blob([source], {type: 'text/html'});
            
            // ARCHITECT FIX: Prevent Memory Leak
            if (els.preview.src) {
                URL.revokeObjectURL(els.preview.src);
            }
            
            els.preview.src = URL.createObjectURL(blob);
            setTimeout(() => els.saveTag.style.opacity = '0', 1200);
        }

        function downloadProject() {
            const combined = `<!DOCTYPE html>\n<html>\n<head>\n<style>\n${store.css}\n</style>\n</head>\n<body>\n${store.html}\n<script>\n${store.js}\n<\/script>\n</body>\n</html>`;
            const blob = new Blob([combined], {type: 'text/html'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `silenvault_project_${Date.now()}.html`;
            a.click();
            URL.revokeObjectURL(url); // Clean up download blob
            showToast('Project Exported');
        }

        function showToast(msg) {
            els.toast.innerText = msg;
            els.toast.classList.remove('opacity-0', 'translate-y-4');
            els.toast.classList.add('opacity-100', 'translate-y-0');
            setTimeout(() => {
                els.toast.classList.remove('opacity-100', 'translate-y-0');
                els.toast.classList.add('opacity-0', 'translate-y-4');
            }, 3200);
        }

        function syncScroll() {
            els.lines.scrollTop = els.input.scrollTop;
            document.getElementById('highlight-overlay').scrollTop = els.input.scrollTop;
            document.getElementById('highlight-overlay').scrollLeft = els.input.scrollLeft;
        }

        // Event Listeners
        els.input.addEventListener('input', () => {
            updateLineNumbers();
            updateHighlight();
            debounceCompile();
            syncScroll();
        });

        els.input.addEventListener('scroll', syncScroll);

        // ARCHITECT FIX: Preserving Undo/Redo stack via execCommand
        els.input.addEventListener('keydown', function(e) {
            if (e.key === 'Tab') {
                e.preventDefault();
                document.execCommand('insertText', false, '    ');
                updateHighlight();
                debounceCompile();
            }
            else if (e.key === 'Enter') {
                e.preventDefault();
                const start = this.selectionStart;
                const before = this.value.substring(0, start);
                const currentLine = before.split('\n').pop() || '';
                const indent = currentLine.match(/^\s*/)[0];
                
                document.execCommand('insertText', false, '\n' + indent);
                updateHighlight();
                updateLineNumbers();
                debounceCompile();
                syncScroll();
            }
        });

        // Initialize
        window.onload = () => {
            els.input.value = store.html;
            updateLineNumbers();
            updateHighlight();
            compile();
        };
    </script>
</body>
</html>
