<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyboard Architect Pro | SilenVault</title>
    <meta name="description" content="Test your keyboard keys, check for ghosting, and analyze raw JavaScript key codes in real-time.">
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5449371042798610" crossorigin="anonymous"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="../assets/js/layout.js" defer></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #f8fafc; overflow-x: hidden; }
        .glass-panel { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(51, 65, 85, 0.5); }
        .mono { font-family: 'Fira Code', monospace; }

        /* Keyboard UI Layout */
        .keyboard { display: flex; flex-direction: column; gap: 0.5rem; max-width: 1000px; margin: 0 auto; padding: 2rem; background: #0b1120; border-radius: 1.5rem; border: 1px solid #1e293b; box-shadow: inset 0 0 40px rgba(0,0,0,0.5); }
        .row { display: flex; gap: 0.5rem; justify-content: center; }
        
        .key {
            background: #1e293b; border: 1px solid #334155; border-bottom-width: 4px;
            color: #94a3b8; font-family: 'Fira Code', monospace; font-size: 0.8rem;
            display: flex; align-items: center; justify-content: center;
            border-radius: 0.5rem; min-width: 3rem; height: 3rem;
            transition: all 0.1s; user-select: none;
        }

        /* Key States */
        .key.active {
            background: #3b82f6; color: white; border-color: #2563eb;
            border-bottom-width: 1px; transform: translateY(3px);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);
        }

        .key.tested {
            background: rgba(16, 185, 129, 0.1); color: #10b981;
            border-color: #059669;
        }

        /* Key Width Overrides */
        .w-1-5 { width: 4.5rem; }
        .w-2 { width: 6rem; }
        .w-2-5 { width: 7.5rem; }
        .w-space { width: 18rem; }
        .w-enter { width: 6.8rem; }

        .data-box { background: #020617; border: 1px solid #1e293b; border-radius: 0.5rem; padding: 1rem; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <sv-header base-path=".."></sv-header>

    <main class="flex-1 max-w-7xl mx-auto w-full px-4 py-12 flex flex-col gap-8">
        
        <div class="text-center mb-4">
            <h1 class="text-3xl md:text-5xl font-bold text-white mb-4 tracking-tight">
                Keyboard <span class="text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-blue-500">Architect</span>
            </h1>
            <p class="text-slate-400 max-w-lg mx-auto">
                Press any key to test hardware functionality and view raw JavaScript event codes.
            </p>
        </div>

        <div class="glass-panel p-6 rounded-3xl border-slate-700 shadow-2xl relative overflow-hidden">
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 text-center max-w-4xl mx-auto">
                <div class="data-box shadow-inner">
                    <span class="block text-[10px] text-slate-500 uppercase tracking-widest font-bold mb-1">event.key</span>
                    <span id="out-key" class="text-xl font-bold text-white mono">-</span>
                </div>
                <div class="data-box shadow-inner">
                    <span class="block text-[10px] text-slate-500 uppercase tracking-widest font-bold mb-1">event.code</span>
                    <span id="out-code" class="text-xl font-bold text-emerald-400 mono">-</span>
                </div>
                <div class="data-box shadow-inner">
                    <span class="block text-[10px] text-slate-500 uppercase tracking-widest font-bold mb-1">event.keyCode</span>
                    <span id="out-keycode" class="text-xl font-bold text-blue-400 mono">-</span>
                </div>
                <div class="data-box shadow-inner relative">
                    <span class="block text-[10px] text-slate-500 uppercase tracking-widest font-bold mb-1">Tested Keys</span>
                    <span class="text-xl font-bold text-purple-400 mono"><span id="tested-count">0</span>/87</span>
                    <button onclick="resetTester()" class="absolute right-2 top-2 text-[10px] bg-slate-800 hover:bg-rose-500 hover:text-white text-slate-400 px-2 py-1 rounded transition-colors">Reset</button>
                </div>
            </div>

            <div id="keyboard" class="keyboard"></div>

        </div>

        <div class="grid lg:grid-cols-3 gap-8 mt-4">
            <div class="lg:col-span-2 glass-panel p-8 rounded-2xl border-slate-800 prose prose-invert max-w-none">
                <h2 class="text-2xl font-bold text-white mb-4">How to Test Your Keyboard</h2>
                <ul class="text-sm text-slate-400 leading-relaxed space-y-2">
                    <li><strong>Basic Test:</strong> Press every key on your physical keyboard. If the corresponding key on the screen turns <span class="text-emerald-400">Green</span>, the hardware switch is fully functional.</li>
                    <li><strong>Ghosting / Rollover Test:</strong> Press and hold multiple keys at the exact same time (e.g., A, S, D, F). If some keys do not light up <span class="text-blue-400">Blue</span>, your keyboard has "Ghosting" limitations.</li>
                    <li><strong>Developer Mode:</strong> The HUD above the keyboard displays the exact raw JavaScript strings required to map hotkeys in your web applications.</li>
                </ul>
            </div>

            <div class="space-y-6">
                <div id="sidebar-ad-wrapper" class="hidden opacity-0 transition-opacity duration-1000">
                    <aside class="smart-ad-unit bg-slate-900/50 border border-slate-800 rounded-2xl flex flex-col items-center justify-center p-4 min-h-[250px]">
                        <span class="text-[10px] uppercase tracking-widest text-slate-600 block mb-2 pointer-events-none">Sponsored</span>
                        <ins class="adsbygoogle" 
                             style="display:block" 
                             data-ad-client="ca-pub-5449371042798610" 
                             data-ad-slot="7594122081" 
                             data-ad-format="auto" 
                             data-full-width-responsive="true"></ins>
                        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
                    </aside>
                </div>
            </div>
        </div>

    </main>

    <sv-footer base-path=".."></sv-footer>

    <script>
        // ARCHITECT: Standard 87-Key TKL Layout mapped to standard JS event.code
        const layout = [
            [
                {code: 'Escape', label: 'Esc'}, {code: 'F1', label: 'F1'}, {code: 'F2', label: 'F2'}, {code: 'F3', label: 'F3'}, {code: 'F4', label: 'F4'},
                {code: 'F5', label: 'F5'}, {code: 'F6', label: 'F6'}, {code: 'F7', label: 'F7'}, {code: 'F8', label: 'F8'},
                {code: 'F9', label: 'F9'}, {code: 'F10', label: 'F10'}, {code: 'F11', label: 'F11'}, {code: 'F12', label: 'F12'}
            ],
            [
                {code: 'Backquote', label: '~'}, {code: 'Digit1', label: '1'}, {code: 'Digit2', label: '2'}, {code: 'Digit3', label: '3'},
                {code: 'Digit4', label: '4'}, {code: 'Digit5', label: '5'}, {code: 'Digit6', label: '6'}, {code: 'Digit7', label: '7'},
                {code: 'Digit8', label: '8'}, {code: 'Digit9', label: '9'}, {code: 'Digit0', label: '0'}, {code: 'Minus', label: '-'},
                {code: 'Equal', label: '='}, {code: 'Backspace', label: 'Backspace', class: 'w-2'}
            ],
            [
                {code: 'Tab', label: 'Tab', class: 'w-1-5'}, {code: 'KeyQ', label: 'Q'}, {code: 'KeyW', label: 'W'}, {code: 'KeyE', label: 'E'},
                {code: 'KeyR', label: 'R'}, {code: 'KeyT', label: 'T'}, {code: 'KeyY', label: 'Y'}, {code: 'KeyU', label: 'U'},
                {code: 'KeyI', label: 'I'}, {code: 'KeyO', label: 'O'}, {code: 'KeyP', label: 'P'}, {code: 'BracketLeft', label: '['},
                {code: 'BracketRight', label: ']'}, {code: 'Backslash', label: '\\', class: 'w-1-5'}
            ],
            [
                {code: 'CapsLock', label: 'Caps Lock', class: 'w-2'}, {code: 'KeyA', label: 'A'}, {code: 'KeyS', label: 'S'}, {code: 'KeyD', label: 'D'},
                {code: 'KeyF', label: 'F'}, {code: 'KeyG', label: 'G'}, {code: 'KeyH', label: 'H'}, {code: 'KeyJ', label: 'J'},
                {code: 'KeyK', label: 'K'}, {code: 'KeyL', label: 'L'}, {code: 'Semicolon', label: ';'}, {code: 'Quote', label: "'"},
                {code: 'Enter', label: 'Enter', class: 'w-enter'}
            ],
            [
                {code: 'ShiftLeft', label: 'Shift', class: 'w-2-5'}, {code: 'KeyZ', label: 'Z'}, {code: 'KeyX', label: 'X'}, {code: 'KeyC', label: 'C'},
                {code: 'KeyV', label: 'V'}, {code: 'KeyB', label: 'B'}, {code: 'KeyN', label: 'N'}, {code: 'KeyM', label: 'M'},
                {code: 'Comma', label: ','}, {code: 'Period', label: '.'}, {code: 'Slash', label: '/'}, {code: 'ShiftRight', label: 'Shift', class: 'w-2-5'}
            ],
            [
                {code: 'ControlLeft', label: 'Ctrl', class: 'w-1-5'}, {code: 'MetaLeft', label: 'Win', class: 'w-1-5'}, {code: 'AltLeft', label: 'Alt', class: 'w-1-5'},
                {code: 'Space', label: 'Space', class: 'w-space'},
                {code: 'AltRight', label: 'Alt', class: 'w-1-5'}, {code: 'MetaRight', label: 'Win', class: 'w-1-5'}, {code: 'ContextMenu', label: 'Menu'}, {code: 'ControlRight', label: 'Ctrl', class: 'w-1-5'}
            ]
        ];

        const keyboardEl = document.getElementById('keyboard');
        const testedKeys = new Set();
        let totalKeys = 0;

        // Render Keyboard
        function renderKeyboard() {
            keyboardEl.innerHTML = '';
            totalKeys = 0;
            layout.forEach(row => {
                const rowEl = document.createElement('div');
                rowEl.className = 'row';
                row.forEach(keyData => {
                    const keyEl = document.createElement('div');
                    keyEl.className = `key ${keyData.class || ''}`;
                    keyEl.id = `key-${keyData.code}`;
                    keyEl.innerText = keyData.label;
                    rowEl.appendChild(keyEl);
                    totalKeys++;
                });
                keyboardEl.appendChild(rowEl);
            });
            document.getElementById('tested-count').innerText = testedKeys.size;
        }

        // Handle Key Events
        function handleKey(e, isDown) {
            e.preventDefault(); // Stop scrolling when pressing space/arrows

            const code = e.code;
            const keyEl = document.getElementById(`key-${code}`);

            if (isDown) {
                // Update HUD
                document.getElementById('out-key').innerText = e.key === ' ' ? 'Space' : e.key;
                document.getElementById('out-code').innerText = e.code;
                document.getElementById('out-keycode').innerText = e.keyCode;

                if (keyEl) {
                    keyEl.classList.add('active');
                    if (!testedKeys.has(code)) {
                        testedKeys.add(code);
                        document.getElementById('tested-count').innerText = testedKeys.size;
                    }
                }
            } else {
                if (keyEl) {
                    keyEl.classList.remove('active');
                    keyEl.classList.add('tested');
                }
            }
        }

        function resetTester() {
            testedKeys.clear();
            document.getElementById('tested-count').innerText = '0';
            document.querySelectorAll('.key').forEach(k => {
                k.classList.remove('active', 'tested');
            });
            document.getElementById('out-key').innerText = '-';
            document.getElementById('out-code').innerText = '-';
            document.getElementById('out-keycode').innerText = '-';
        }

        // Prevent browser shortcuts from stealing focus
        window.addEventListener('keydown', (e) => handleKey(e, true), { passive: false });
        window.addEventListener('keyup', (e) => handleKey(e, false), { passive: false });

        // ARCHITECT: Ad-Sensing Logic
        function monitorAds() {
            const adSlot = document.querySelector('#sidebar-ad-wrapper ins.adsbygoogle');
            const container = document.getElementById('sidebar-ad-wrapper');
            if (!adSlot) return;

            const observer = new MutationObserver(() => {
                const status = adSlot.getAttribute('data-ad-status');
                if (status === 'filled' || adSlot.innerHTML.includes('iframe')) {
                    container.classList.remove('hidden');
                    // Small delay to allow the CSS to recognize the display block before fading
                    setTimeout(() => container.classList.add('opacity-100'), 50);
                    observer.disconnect();
                } else if (status === 'unfilled') {
                    container.classList.add('hidden');
                }
            });

            observer.observe(adSlot, { attributes: true, childList: true });
            
            // Failsafe: if AdSense network fails entirely, remove the empty box
            setTimeout(() => { 
                if (!adSlot.innerHTML.includes('iframe')) container.style.display = 'none'; 
            }, 5000);
        }

        // Init
        window.onload = () => {
            renderKeyboard();
            monitorAds();
        };
    </script>
</body>
</html>
