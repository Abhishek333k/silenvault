<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online HTML, CSS & JS Sandbox | SilenVault</title>
    <meta name="description" content="Free, local-first frontend web IDE. Write HTML, CSS, and JavaScript with live preview, auto-save, console output, and CDN injection.">
    <meta name="keywords" content="html sandbox, online web ide, css editor, javascript compiler online, frontend code editor, codepen alternative free">
    
    <meta property="og:title" content="Online HTML/JS Sandbox | SilenVault">
    <meta property="og:description" content="Professional sandboxed code editor. Test your frontend code locally in your browser.">
    <meta property="og:type" content="website">
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5449371042798610" crossorigin="anonymous"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="../assets/js/layout.js" defer></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closetag.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closebrackets.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #f8fafc; overflow-x: hidden; display: flex; flex-direction: column; min-height: 100vh; }
        .glass-panel { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(51, 65, 85, 0.5); }
        .mono { font-family: 'Fira Code', monospace; }

        /* Full Screen IDE Wrapper */
        .ide-wrapper {
            height: calc(100vh - 200px); 
            min-height: 500px; display: flex; border-radius: 0.75rem;
            overflow: hidden; border: 1px solid #1e293b; box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            background: #0f172a; position: relative;
        }

        #editor-pane { width: 50%; display: flex; flex-direction: column; min-width: 200px; background: #0f172a; }
        .editor-container { flex: 1; position: relative; }

        .CodeMirror {
            position: absolute !important; top: 0; left: 0; right: 0; bottom: 0;
            height: 100% !important; font-family: 'Fira Code', monospace; 
            font-size: 14px; background: #0f172a !important; 
        }
        .cm-s-dracula.CodeMirror { box-shadow: none; border: none; }
        .cm-s-dracula .CodeMirror-gutters { background-color: #020617; border-right: 1px solid #1e293b; }

        #resizer {
            width: 8px; background: #020617; border-left: 1px solid #1e293b; border-right: 1px solid #1e293b;
            cursor: col-resize; display: flex; align-items: center; justify-content: center;
            transition: background 0.2s; z-index: 50;
        }
        #resizer:hover, #resizer:active { background: #3b82f6; }
        #resizer::after { content: ''; width: 2px; height: 30px; background: #334155; border-radius: 2px; }

        /* Right Pane Split */
        #right-pane { flex: 1; display: flex; flex-direction: column; min-width: 200px; position: relative; }
        #preview-container { flex: 1; background: #ffffff; position: relative; }
        #preview-frame { width: 100%; height: 100%; border: none; background: white; display: block; }
        #iframe-overlay { position: absolute; inset: 0; z-index: 40; display: none; }

        /* Custom Output Terminal */
        #console-container {
            height: 150px; background: #020617; border-top: 2px solid #1e293b;
            display: flex; flex-direction: column; transition: height 0.3s ease;
        }
        #console-container.minimized { height: 32px; }
        #console-output {
            flex: 1; overflow-y: auto; padding: 10px; font-family: 'Fira Code', monospace;
            font-size: 11px; color: #cbd5e1; display: flex; flex-direction: column; gap: 4px;
        }
        .log-entry { border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 4px; }
        .log-error { color: #f43f5e; }
        .log-warn { color: #f59e0b; }

        .tab-btn {
            padding: 10px 20px; font-size: 12px; font-weight: bold; text-transform: uppercase;
            letter-spacing: 1px; color: #64748b; background: transparent;
            border-bottom: 2px solid transparent; transition: all 0.2s;
            display: flex; items-center; gap: 8px;
        }
        .tab-btn.active { color: #f8fafc; border-bottom-color: #3b82f6; background: #0f172a; }
        .tab-btn:hover:not(.active) { color: #cbd5e1; background: rgba(255,255,255,0.02); }

        /* CDN Modal */
        #settings-modal {
            background: rgba(2, 6, 23, 0.8); backdrop-filter: blur(8px);
        }
        .settings-textarea {
            width: 100%; background: #0f172a; border: 1px solid #1e293b; color: #cbd5e1;
            padding: 10px; border-radius: 8px; font-size: 12px; font-family: monospace;
            resize: vertical; min-height: 80px; outline: none; transition: border-color 0.2s;
        }
        .settings-textarea:focus { border-color: #3b82f6; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <sv-header base-path=".."></sv-header>

    <main class="flex-1 w-full px-4 md:px-8 py-6 flex flex-col gap-4 max-w-[2000px] mx-auto relative">
        
        <div class="flex flex-col md:flex-row items-center justify-between gap-4 mb-2">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold text-white tracking-tight flex items-center gap-3">
                    Web <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500">IDE</span>
                </h1>
                <p class="text-xs text-slate-400 mt-1">Professional web IDE. Drag center bar to resize. View logs in the console.</p>
            </div>
            
            <div class="flex flex-wrap items-center gap-3 w-full md:w-auto">
                <span id="save-status" class="text-[10px] font-mono font-bold text-emerald-400 uppercase tracking-widest flex items-center gap-2 px-2 hidden md:flex">
                    <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span> Saved
                </span>
                
                <button onclick="openSettings()" class="bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs font-bold px-4 py-2.5 rounded-xl transition-all border border-slate-700 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                    Libraries / CDNs
                </button>

                <button onclick="downloadCode()" class="bg-purple-600 hover:bg-purple-500 text-white text-xs font-bold px-6 py-2.5 rounded-xl transition-all shadow-[0_0_15px_rgba(168,85,247,0.4)] flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                    Export .html
                </button>
            </div>
        </div>

        <div class="ide-wrapper">
            
            <div id="editor-pane">
                <div class="flex justify-between items-center bg-[#020617] border-b border-slate-800 pr-2">
                    <div class="flex pt-2 px-2">
                        <button id="tab-html" onclick="switchTab('html')" class="tab-btn active text-rose-400">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/></svg> HTML
                        </button>
                        <button id="tab-css" onclick="switchTab('css')" class="tab-btn">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/></svg> CSS
                        </button>
                        <button id="tab-js" onclick="switchTab('js')" class="tab-btn">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg> JS
                        </button>
                    </div>
                </div>

                <div id="html-container" class="editor-container"><textarea id="html-code"></textarea></div>
                <div id="css-container" class="editor-container hidden"><textarea id="css-code"></textarea></div>
                <div id="js-container" class="editor-container hidden"><textarea id="js-code"></textarea></div>
            </div>

            <div id="resizer"></div>

            <div id="right-pane">
                
                <div id="preview-container">
                    <div class="absolute top-0 right-0 bg-slate-900/80 text-white text-[10px] font-mono px-3 py-1 m-2 rounded backdrop-blur border border-slate-700 z-10 pointer-events-none shadow-md">Live Output</div>
                    <div id="iframe-overlay"></div>
                    <iframe id="preview-frame" sandbox="allow-scripts allow-modals"></iframe>
                </div>

                <div id="console-container">
                    <div class="flex justify-between items-center bg-[#020617] px-4 py-1.5 border-b border-slate-800 cursor-pointer" onclick="toggleConsole()">
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M4 6h16a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2z"/></svg>
                            System Console
                        </span>
                        <div class="flex items-center gap-3">
                            <button onclick="clearConsole(event)" class="text-[10px] text-slate-500 hover:text-white uppercase font-bold">Clear</button>
                            <svg id="console-chevron" class="w-4 h-4 text-slate-500 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                        </div>
                    </div>
                    <div id="console-output"></div>
                </div>

            </div>
        </div>

        <div id="settings-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4">
            <div class="glass-panel p-6 rounded-2xl w-full max-w-lg border border-slate-700 shadow-2xl relative">
                <button onclick="closeSettings()" class="absolute top-4 right-4 text-slate-500 hover:text-white">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
                <h2 class="text-xl font-bold text-white mb-2">External Libraries</h2>
                <p class="text-xs text-slate-400 mb-6">Paste CDN links here (e.g., Tailwind, Bootstrap, React). The engine will automatically inject them into the document <code>&lt;head&gt;</code>.</p>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-[10px] font-bold text-blue-400 uppercase tracking-widest mb-1">CSS Stylesheets (1 URL per line)</label>
                        <textarea id="inp-cdn-css" class="settings-textarea" placeholder="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"></textarea>
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-amber-400 uppercase tracking-widest mb-1">JavaScript (1 URL per line)</label>
                        <textarea id="inp-cdn-js" class="settings-textarea" placeholder="https://cdn.tailwindcss.com"></textarea>
                    </div>
                </div>
                
                <div class="mt-6 flex justify-end">
                    <button onclick="saveSettings()" class="bg-blue-600 hover:bg-blue-500 text-white text-sm font-bold px-6 py-2 rounded-xl transition-all shadow-[0_0_15px_rgba(37,99,235,0.4)]">
                        Save & Reload Engine
                    </button>
                </div>
            </div>
        </div>

        <div class="grid lg:grid-cols-3 gap-8 mt-6">
            <div class="lg:col-span-2 glass-panel p-8 rounded-2xl border-slate-800 prose prose-invert max-w-none">
                <h2 class="text-xl font-bold text-white mb-4">The Ultimate Online Code Editor</h2>
                <p class="text-sm text-slate-400 leading-relaxed mb-4">
                    SilenVault's Web IDE is a high-performance alternative to platforms like CodePen and JSFiddle. Built for developers who need to prototype frontend interfaces instantly without dealing with account logins or cloud synchronization delays.
                </p>
                <ul class="text-sm text-slate-400 leading-relaxed space-y-3 m-0 p-0 list-none">
                    <li><strong class="text-purple-400">Library & CDN Support:</strong> Click the ⚙️ Libraries button to easily import TailwindCSS, Bootstrap, React, or jQuery via standard CDN links.</li>
                    <li><strong class="text-slate-200">System Console Hijacking:</strong> Our engine safely hijacks the sandboxed iframe's <code>console.log()</code> and global error events, displaying your Javascript outputs perfectly in the integrated terminal UI.</li>
                    <li><strong class="text-slate-200">Production Export:</strong> Once your UI prototype is complete, click "Export .html". The IDE mathematically merges your CSS, JS, and CDN links into a single, production-ready document for download.</li>
                </ul>
            </div>

            <div class="space-y-6">
                <div id="sidebar-ad-wrapper" class="hidden opacity-0 transition-opacity duration-1000">
                    <aside class="smart-ad-unit bg-slate-900/50 border border-slate-800 rounded-2xl flex flex-col items-center justify-center p-4 min-h-[250px]">
                        <span class="text-[10px] uppercase tracking-widest text-slate-600 block mb-2 pointer-events-none">Sponsored</span>
                        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5449371042798610" data-ad-slot="7594122081" data-ad-format="auto" data-full-width-responsive="true"></ins>
                    </aside>
                </div>
            </div>
        </div>

    </main>

    <sv-footer base-path=".."></sv-footer>

    <script>
        // --- 1. DEFAULT DATA & STATE ---
        const defaultHTML = `<div class="p-8 text-center">\n  <h1 class="text-4xl font-bold text-purple-500 mb-4">SilenVault IDE</h1>\n  <p class="text-slate-400 mb-6">TailwindCSS is pre-loaded via CDN. Start building.</p>\n  <button id="testBtn" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-500 font-bold transition-all">Test Console Output</button>\n</div>`;
        const defaultCSS = `body {\n  background-color: #020617;\n  color: white;\n}`;
        const defaultJS = `console.log("IDE initialized securely.");\n\ndocument.getElementById('testBtn').addEventListener('click', () => {\n  console.warn("User clicked the test button.");\n  // console.error("Simulated error!");\n});`;
        const defaultCDNJS = `https://cdn.tailwindcss.com`;

        const initHTML = localStorage.getItem('sv_ide_html') || defaultHTML;
        const initCSS = localStorage.getItem('sv_ide_css') || defaultCSS;
        const initJS = localStorage.getItem('sv_ide_js') || defaultJS;
        const initCDNCSS = localStorage.getItem('sv_ide_cdn_css') || '';
        const initCDNJS = localStorage.getItem('sv_ide_cdn_js') || defaultCDNJS;

        // --- 2. CODEMIRROR INIT ---
        const cmOptions = { theme: "dracula", lineNumbers: true, lineWrapping: true, autoCloseTags: true, autoCloseBrackets: true, tabSize: 2 };
        const editorHTML = CodeMirror.fromTextArea(document.getElementById("html-code"), { ...cmOptions, mode: "xml", htmlMode: true });
        const editorCSS = CodeMirror.fromTextArea(document.getElementById("css-code"), { ...cmOptions, mode: "css" });
        const editorJS = CodeMirror.fromTextArea(document.getElementById("js-code"), { ...cmOptions, mode: "javascript" });

        editorHTML.setValue(initHTML);
        editorCSS.setValue(initCSS);
        editorJS.setValue(initJS);

        // --- 3. UI LOGIC ---
        function switchTab(tabId) {
            ['html', 'css', 'js'].forEach(t => {
                document.getElementById(`${t}-container`).classList.add('hidden');
                document.getElementById(`tab-${t}`).classList.remove('active', 'text-rose-400', 'text-blue-400', 'text-amber-400');
            });
            document.getElementById(`${tabId}-container`).classList.remove('hidden');
            const btn = document.getElementById(`tab-${tabId}`);
            btn.classList.add('active');
            if(tabId === 'html') { btn.classList.add('text-rose-400'); editorHTML.refresh(); }
            if(tabId === 'css') { btn.classList.add('text-blue-400'); editorCSS.refresh(); }
            if(tabId === 'js') { btn.classList.add('text-amber-400'); editorJS.refresh(); }
        }

        // Resizer
        const resizer = document.getElementById('resizer');
        const editorPane = document.getElementById('editor-pane');
        const iframeOverlay = document.getElementById('iframe-overlay');
        let isResizing = false;

        resizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            iframeOverlay.style.display = 'block'; 
            document.body.style.cursor = 'col-resize';
            e.preventDefault();
        });
        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;
            let newWidth = e.clientX;
            if (newWidth < 300) newWidth = 300;
            if (newWidth > window.innerWidth - 300) newWidth = window.innerWidth - 300;
            editorPane.style.width = `${newWidth}px`;
            editorPane.style.flex = "none";
        });
        document.addEventListener('mouseup', () => {
            if (isResizing) {
                isResizing = false;
                iframeOverlay.style.display = 'none';
                document.body.style.cursor = 'default';
            }
        });

        // Console UI Toggle
        function toggleConsole() {
            const container = document.getElementById('console-container');
            const chevron = document.getElementById('console-chevron');
            container.classList.toggle('minimized');
            if(container.classList.contains('minimized')) { chevron.style.transform = 'rotate(180deg)'; } 
            else { chevron.style.transform = 'rotate(0deg)'; }
        }

        // --- 4. COMPILER ENGINE & CONSOLE HIJACK ---
        const iframe = document.getElementById('preview-frame');
        const saveStatus = document.getElementById('save-status');
        const consoleOut = document.getElementById('console-output');
        let timeout;

        // The script that gets injected into the iframe to catch logs
        const hijackScript = `
            <script>
                (function() {
                    const ogConsole = window.console;
                    function sendLog(level, args) {
                        const msg = Array.from(args).map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' ');
                        window.parent.postMessage({ type: 'sv_console', level: level, msg: msg }, '*');
                    }
                    window.console = {
                        log: function(...args) { ogConsole.log(...args); sendLog('log', args); },
                        warn: function(...args) { ogConsole.warn(...args); sendLog('warn', args); },
                        error: function(...args) { ogConsole.error(...args); sendLog('error', args); },
                        info: function(...args) { ogConsole.info(...args); sendLog('info', args); }
                    };
                    window.onerror = function(msg, url, line) {
                        window.parent.postMessage({ type: 'sv_console', level: 'error', msg: msg + ' (Line ' + line + ')' }, '*');
                        return false;
                    };
                })();
            <\/script>
        `;

        function compilePreview() {
            const html = editorHTML.getValue();
            const css = editorCSS.getValue();
            const js = editorJS.getValue();
            
            const cdnCSS = localStorage.getItem('sv_ide_cdn_css') || '';
            const cdnJS = localStorage.getItem('sv_ide_cdn_js') || '';

            localStorage.setItem('sv_ide_html', html);
            localStorage.setItem('sv_ide_css', css);
            localStorage.setItem('sv_ide_js', js);

            // Generate CDN HTML blocks
            const linksCSS = cdnCSS.split('\\n').filter(l => l.trim()).map(l => `<link rel="stylesheet" href="${l.trim()}">`).join('\\n');
            const scriptsJS = cdnJS.split('\\n').filter(l => l.trim()).map(l => `<script src="${l.trim()}"><\/script>`).join('\\n');

            const srcdoc = `<!DOCTYPE html>\n<html>\n<head>\n${hijackScript}\n${linksCSS}\n<style>\n${css}\n</style>\n</head>\n<body>\n${html}\n${scriptsJS}\n<script>\n${js}\n<\/script>\n</body>\n</html>`;
            iframe.srcdoc = srcdoc;

            saveStatus.innerHTML = `<span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span> Saved`;
            saveStatus.className = "text-[10px] font-mono font-bold text-emerald-400 uppercase tracking-widest flex items-center gap-2";
        }

        // Receive Logs from iframe
        window.addEventListener('message', (e) => {
            if (e.data && e.data.type === 'sv_console') {
                const line = document.createElement('div');
                line.className = 'log-entry';
                if (e.data.level === 'error') line.classList.add('log-error');
                if (e.data.level === 'warn') line.classList.add('log-warn');
                line.innerText = `> ${e.data.msg}`;
                consoleOut.appendChild(line);
                consoleOut.scrollTop = consoleOut.scrollHeight;
            }
        });

        function clearConsole(e) {
            if(e) e.stopPropagation(); // prevent toggling the container
            consoleOut.innerHTML = '';
        }

        function handleInput() {
            saveStatus.innerHTML = `<span class="w-2 h-2 rounded-full bg-amber-500"></span> Typing...`;
            saveStatus.className = "text-[10px] font-mono font-bold text-amber-400 uppercase tracking-widest flex items-center gap-2";
            clearTimeout(timeout);
            timeout = setTimeout(compilePreview, 800); // 800ms Debounce
        }

        editorHTML.on("change", handleInput);
        editorCSS.on("change", handleInput);
        editorJS.on("change", handleInput);

        // --- 5. SETTINGS / CDN MODAL ---
        function openSettings() {
            document.getElementById('inp-cdn-css').value = localStorage.getItem('sv_ide_cdn_css') || '';
            document.getElementById('inp-cdn-js').value = localStorage.getItem('sv_ide_cdn_js') || '';
            document.getElementById('settings-modal').classList.remove('hidden');
        }

        function closeSettings() {
            document.getElementById('settings-modal').classList.add('hidden');
        }

        function saveSettings() {
            localStorage.setItem('sv_ide_cdn_css', document.getElementById('inp-cdn-css').value);
            localStorage.setItem('sv_ide_cdn_js', document.getElementById('inp-cdn-js').value);
            closeSettings();
            compilePreview(); // Force reload with new CDNs
        }

        // --- 6. EXPORT ---
        function downloadCode() {
            const html = editorHTML.getValue();
            const css = editorCSS.getValue();
            const js = editorJS.getValue();
            const cdnCSS = localStorage.getItem('sv_ide_cdn_css') || '';
            const cdnJS = localStorage.getItem('sv_ide_cdn_js') || '';

            const linksCSS = cdnCSS.split('\\n').filter(l => l.trim()).map(l => `<link rel="stylesheet" href="${l.trim()}">`).join('\\n');
            const scriptsJS = cdnJS.split('\\n').filter(l => l.trim()).map(l => `<script src="${l.trim()}"><\/script>`).join('\\n');

            const finalCode = `<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="UTF-8">\n<meta name="viewport" content="width=device-width, initial-scale=1.0">\n<title>SilenVault Export</title>\n${linksCSS}\n<style>\n${css}\n</style>\n</head>\n<body>\n${html}\n${scriptsJS}\n<script>\n${js}\n<\/script>\n</body>\n</html>`;

            const blob = new Blob([finalCode], { type: "text/html" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "silenvault_project.html";
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize First Run
        compilePreview();
    </script>
</body>
</html>
