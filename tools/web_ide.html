<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architect Pro IDE | SilenVault</title>
    <meta name="description" content="Professional in-browser HTML, CSS, and JavaScript IDE. Sandboxed live preview, resizable panels, and auto-save.">
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5449371042798610" crossorigin="anonymous"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="../assets/js/layout.js" defer></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closetag.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closebrackets.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #f8fafc; overflow-x: hidden; display: flex; flex-direction: column; min-height: 100vh; }
        .glass-panel { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(51, 65, 85, 0.5); }
        .mono { font-family: 'Fira Code', monospace; }

        /* Full Screen IDE Wrapper */
        .ide-wrapper {
            height: calc(100vh - 200px); /* Responsive tall height */
            min-height: 500px;
            display: flex;
            border-radius: 0.75rem;
            overflow: hidden;
            border: 1px solid #1e293b;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            background: #0f172a;
        }

        /* Left Side: Code Editor */
        #editor-pane { width: 50%; display: flex; flex-direction: column; min-width: 200px; background: #0f172a; }
        
        .editor-container { flex: 1; position: relative; }

        /* Force CodeMirror to fill parent perfectly */
        .CodeMirror {
            position: absolute !important;
            top: 0; left: 0; right: 0; bottom: 0;
            height: 100% !important;
            font-family: 'Fira Code', monospace; 
            font-size: 14px; 
            background: #0f172a !important; 
        }
        .cm-s-dracula.CodeMirror { box-shadow: none; border: none; }
        .cm-s-dracula .CodeMirror-gutters { background-color: #020617; border-right: 1px solid #1e293b; }

        /* The Draggable Splitter */
        #resizer {
            width: 8px; background: #020617; border-left: 1px solid #1e293b; border-right: 1px solid #1e293b;
            cursor: col-resize; display: flex; align-items: center; justify-content: center;
            transition: background 0.2s; z-index: 50;
        }
        #resizer:hover, #resizer:active { background: #3b82f6; }
        #resizer::after { content: ''; width: 2px; height: 30px; background: #334155; border-radius: 2px; }

        /* Right Side: Preview */
        #preview-pane { flex: 1; background: #ffffff; position: relative; min-width: 200px; }
        #preview-frame { width: 100%; height: 100%; border: none; background: white; display: block; }
        
        /* Overlay stops iframe from stealing mouse events during drag */
        #iframe-overlay { position: absolute; inset: 0; z-index: 40; display: none; }

        /* Tabs UI */
        .tab-btn {
            padding: 10px 20px; font-size: 12px; font-weight: bold; text-transform: uppercase;
            letter-spacing: 1px; color: #64748b; background: transparent;
            border-bottom: 2px solid transparent; transition: all 0.2s;
            display: flex; items-center; gap: 8px;
        }
        .tab-btn.active { color: #f8fafc; border-bottom-color: #3b82f6; background: #0f172a; }
        .tab-btn:hover:not(.active) { color: #cbd5e1; background: rgba(255,255,255,0.02); }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <sv-header base-path=".."></sv-header>

    <main class="flex-1 w-full px-4 md:px-8 py-6 flex flex-col gap-4 max-w-[2000px] mx-auto">
        
        <div class="flex flex-col md:flex-row items-center justify-between gap-4 mb-2">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold text-white tracking-tight flex items-center gap-3">
                    Architect <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500">IDE</span>
                </h1>
                <p class="text-xs text-slate-400 mt-1">Professional sandboxed editor. Drag the center bar to resize.</p>
            </div>
            
            <div class="flex items-center gap-3 w-full md:w-auto">
                <div class="flex items-center gap-2 bg-slate-900 border border-slate-800 px-4 py-2 rounded-xl">
                    <span id="save-status" class="text-[10px] font-mono font-bold text-emerald-400 uppercase tracking-widest flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span> Saved
                    </span>
                </div>
                
                <button onclick="downloadCode()" class="bg-purple-600 hover:bg-purple-500 text-white text-xs font-bold px-6 py-2.5 rounded-xl transition-all shadow-[0_0_15px_rgba(168,85,247,0.4)] flex items-center gap-2 shrink-0">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                    Export .html
                </button>
            </div>
        </div>

        <div class="ide-wrapper">
            
            <div id="editor-pane">
                
                <div class="flex bg-[#020617] border-b border-slate-800 px-2 pt-2">
                    <button id="tab-html" onclick="switchTab('html')" class="tab-btn active text-rose-400">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/></svg> HTML
                    </button>
                    <button id="tab-css" onclick="switchTab('css')" class="tab-btn">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/></svg> CSS
                    </button>
                    <button id="tab-js" onclick="switchTab('js')" class="tab-btn">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg> JS
                    </button>
                </div>

                <div id="html-container" class="editor-container"><textarea id="html-code"></textarea></div>
                <div id="css-container" class="editor-container hidden"><textarea id="css-code"></textarea></div>
                <div id="js-container" class="editor-container hidden"><textarea id="js-code"></textarea></div>
            </div>

            <div id="resizer"></div>

            <div id="preview-pane">
                <div class="absolute top-0 right-0 bg-slate-900/80 text-white text-[10px] font-mono px-3 py-1 m-2 rounded backdrop-blur border border-slate-700 z-50 pointer-events-none shadow-md">Output Console</div>
                <div id="iframe-overlay"></div>
                <iframe id="preview-frame" sandbox="allow-scripts allow-modals"></iframe>
            </div>

        </div>

    </main>

    <sv-footer base-path=".."></sv-footer>

    <script>
        // Default Boilerplate
        const defaultHTML = `<div class="hero">\n  <h1>SilenVault IDE</h1>\n  <p>Your local-first coding environment.</p>\n  <button onclick="showAlert()">Test JavaScript</button>\n</div>`;
        const defaultCSS = `body {\n  margin: 0;\n  padding: 0;\n  font-family: system-ui, sans-serif;\n  background: linear-gradient(135deg, #1e293b, #0f172a);\n  color: white;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100vh;\n}\n\n.hero {\n  background: rgba(255, 255, 255, 0.05);\n  padding: 40px;\n  border-radius: 16px;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  text-align: center;\n}\n\nh1 {\n  color: #a855f7;\n  margin-top: 0;\n  font-size: 2.5rem;\n}\n\nbutton {\n  margin-top: 20px;\n  background: #a855f7;\n  color: white;\n  border: none;\n  padding: 10px 20px;\n  border-radius: 8px;\n  font-weight: bold;\n  cursor: pointer;\n  transition: transform 0.1s;\n}\n\nbutton:active {\n  transform: scale(0.95);\n}`;
        const defaultJS = `function showAlert() {\n  alert("The Javascript Engine is running securely!");\n}`;

        // Load Memory
        const initHTML = localStorage.getItem('sv_ide_html') || defaultHTML;
        const initCSS = localStorage.getItem('sv_ide_css') || defaultCSS;
        const initJS = localStorage.getItem('sv_ide_js') || defaultJS;

        // Init CodeMirror Instances
        const cmOptions = { theme: "dracula", lineNumbers: true, lineWrapping: true, autoCloseTags: true, autoCloseBrackets: true, tabSize: 2 };
        const editorHTML = CodeMirror.fromTextArea(document.getElementById("html-code"), { ...cmOptions, mode: "xml", htmlMode: true });
        const editorCSS = CodeMirror.fromTextArea(document.getElementById("css-code"), { ...cmOptions, mode: "css" });
        const editorJS = CodeMirror.fromTextArea(document.getElementById("js-code"), { ...cmOptions, mode: "javascript" });

        editorHTML.setValue(initHTML);
        editorCSS.setValue(initCSS);
        editorJS.setValue(initJS);

        // --- TAB SWITCHING LOGIC ---
        function switchTab(tabId) {
            // Hide all
            ['html', 'css', 'js'].forEach(t => {
                document.getElementById(`${t}-container`).classList.add('hidden');
                document.getElementById(`tab-${t}`).classList.remove('active', 'text-rose-400', 'text-blue-400', 'text-amber-400');
            });
            
            // Show Active
            document.getElementById(`${tabId}-container`).classList.remove('hidden');
            const btn = document.getElementById(`tab-${tabId}`);
            btn.classList.add('active');
            
            if(tabId === 'html') { btn.classList.add('text-rose-400'); editorHTML.refresh(); }
            if(tabId === 'css') { btn.classList.add('text-blue-400'); editorCSS.refresh(); }
            if(tabId === 'js') { btn.classList.add('text-amber-400'); editorJS.refresh(); }
        }

        // --- RESIZER LOGIC ---
        const resizer = document.getElementById('resizer');
        const editorPane = document.getElementById('editor-pane');
        const iframeOverlay = document.getElementById('iframe-overlay');
        let isResizing = false;

        resizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            iframeOverlay.style.display = 'block'; // Block iframe stealing mouse
            document.body.style.cursor = 'col-resize';
            e.preventDefault();
        });

        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;
            // Calculate width relative to the left side of the window
            let newWidth = e.clientX;
            // Constrain width
            if (newWidth < 300) newWidth = 300;
            if (newWidth > window.innerWidth - 300) newWidth = window.innerWidth - 300;
            
            editorPane.style.width = `${newWidth}px`;
            editorPane.style.flex = "none"; // Remove flex 1/2 so absolute width applies
        });

        document.addEventListener('mouseup', () => {
            if (isResizing) {
                isResizing = false;
                iframeOverlay.style.display = 'none';
                document.body.style.cursor = 'default';
            }
        });

        // --- COMPILER ENGINE ---
        const iframe = document.getElementById('preview-frame');
        const saveStatus = document.getElementById('save-status');
        let timeout;

        function compilePreview() {
            const html = editorHTML.getValue();
            const css = editorCSS.getValue();
            const js = editorJS.getValue();

            localStorage.setItem('sv_ide_html', html);
            localStorage.setItem('sv_ide_css', css);
            localStorage.setItem('sv_ide_js', js);

            const srcdoc = `<!DOCTYPE html>\n<html>\n<head>\n<style>\n${css}\n</style>\n</head>\n<body>\n${html}\n<script>\n${js}\n<\/script>\n</body>\n</html>`;
            iframe.srcdoc = srcdoc;

            saveStatus.innerHTML = `<span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span> Saved`;
            saveStatus.className = "text-[10px] font-mono font-bold text-emerald-400 uppercase tracking-widest flex items-center gap-2";
        }

        function handleInput() {
            saveStatus.innerHTML = `<span class="w-2 h-2 rounded-full bg-amber-500"></span> Typing...`;
            saveStatus.className = "text-[10px] font-mono font-bold text-amber-400 uppercase tracking-widest flex items-center gap-2";
            
            clearTimeout(timeout);
            timeout = setTimeout(compilePreview, 500); // 500ms Debounce
        }

        editorHTML.on("change", handleInput);
        editorCSS.on("change", handleInput);
        editorJS.on("change", handleInput);

        compilePreview(); // Init

        // --- EXPORT ---
        function downloadCode() {
            const html = editorHTML.getValue();
            const css = editorCSS.getValue();
            const js = editorJS.getValue();
            const finalCode = `<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="UTF-8">\n<meta name="viewport" content="width=device-width, initial-scale=1.0">\n<title>SilenVault Export</title>\n<style>\n${css}\n</style>\n</head>\n<body>\n${html}\n<script>\n${js}\n<\/script>\n</body>\n</html>`;

            const blob = new Blob([finalCode], { type: "text/html" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "silenvault_project.html";
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
