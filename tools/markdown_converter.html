<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Architect Pro | SilenVault</title>
    <meta name="description" content="Free, real-time Markdown to HTML converter. Features live preview, syntax highlighting, and local-first security.">
    
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="../assets/js/layout.js" defer></script>
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #e2e8f0; }
        .glass-panel { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(51, 65, 85, 0.5); }
        .mono { font-family: 'Fira Code', monospace; }
        
        /* IDE Scrollbars */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        .editor-container { height: calc(100vh - 280px); min-height: 500px; }
        
        #md-input {
            background: #0b1120; color: #e2e8f0; resize: none; outline: none; line-height: 1.6; tab-size: 4;
        }

        .preview-pane { background: #ffffff; color: #0f172a; overflow-y: auto; }
        
        /* Force Prism to override Tailwind Typography for code blocks */
        .prose pre { background: #272822 !important; margin-top: 1.5em; margin-bottom: 1.5em; border-radius: 0.5rem; }
        .prose code { color: inherit; background: none; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <sv-header base-path=".."></sv-header>

    <main class="flex-1 max-w-7xl mx-auto w-full px-4 py-8 flex flex-col gap-8">
        
        <div class="text-center mb-2">
            <h1 class="text-3xl md:text-5xl font-bold text-white mb-4 tracking-tight">
                Markdown <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">Architect Pro</span>
            </h1>
            <p class="text-slate-400 max-w-lg mx-auto">
                Write in Markdown. See HTML instantly. 100% secure, local rendering.
            </p>
        </div>

        <div class="glass-panel rounded-2xl flex flex-col overflow-hidden border border-slate-700 shadow-2xl">
            
            <div class="bg-slate-900 border-b border-slate-800 p-3 flex flex-wrap items-center justify-between gap-4 z-10">
                
                <div class="flex items-center gap-1 bg-slate-950 p-1 rounded-lg border border-slate-800">
                    <button onclick="insertSyntax('**', '**')" class="p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded transition-colors" title="Bold">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6z"/><path stroke-linecap="round" stroke-linejoin="round" d="M6 12h9a4 4 0 014 4 4 4 0 01-4 4H6z"/></svg>
                    </button>
                    <button onclick="insertSyntax('*', '*')" class="p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded transition-colors" title="Italic">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/></svg>
                    </button>
                    <div class="w-px h-5 bg-slate-800 mx-1"></div>
                    <button onclick="insertSyntax('[', '](url)')" class="p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded transition-colors" title="Link">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>
                    </button>
                    <button onclick="insertSyntax('\n```\n', '\n```\n')" class="p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded transition-colors" title="Code Block">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/></svg>
                    </button>
                </div>

                <div class="flex items-center gap-2">
                    <button onclick="copyHTML()" id="copyBtn" class="bg-slate-800 hover:bg-slate-700 text-white text-[11px] font-bold px-4 py-2 rounded-lg transition-all border border-slate-700 flex items-center gap-2">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
                        Copy HTML
                    </button>
                    <button onclick="downloadFile('html')" class="bg-blue-600 hover:bg-blue-500 text-white text-[11px] font-bold px-4 py-2 rounded-lg transition-all shadow-lg shadow-blue-500/20">
                        ↓ HTML
                    </button>
                    <button onclick="downloadFile('md')" class="bg-purple-600 hover:bg-purple-500 text-white text-[11px] font-bold px-4 py-2 rounded-lg transition-all shadow-lg shadow-purple-500/20">
                        ↓ MD
                    </button>
                </div>
            </div>

            <div class="flex flex-col md:flex-row editor-container">
                <div class="w-full md:w-1/2 flex flex-col border-r border-slate-800 relative">
                    <div class="bg-slate-900 border-b border-slate-800 px-4 py-1.5 text-[10px] font-black text-slate-500 uppercase tracking-widest flex justify-between items-center">
                        <span>Markdown Input</span>
                    </div>
                    <textarea id="md-input" class="w-full flex-1 p-6 mono text-sm" spellcheck="false" placeholder="Start typing Markdown here..."></textarea>
                    
                    <div class="h-8 bg-slate-950 border-t border-slate-800 flex items-center justify-end px-4 gap-4 text-[10px] font-mono text-slate-500 select-none">
                        <span><span id="wordCount" class="text-emerald-400 font-bold">0</span> Words</span>
                        <span><span id="charCount" class="text-blue-400 font-bold">0</span> Chars</span>
                    </div>
                </div>

                <div class="w-full md:w-1/2 flex flex-col relative">
                    <div class="bg-slate-100 border-b border-slate-300 px-4 py-1.5 text-[10px] font-black text-slate-500 uppercase tracking-widest flex justify-between items-center">
                        <span class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                            Live Preview
                        </span>
                        <div class="flex gap-1.5">
                            <div class="w-2 h-2 rounded-full bg-slate-300"></div>
                            <div class="w-2 h-2 rounded-full bg-slate-300"></div>
                            <div class="w-2 h-2 rounded-full bg-slate-300"></div>
                        </div>
                    </div>
                    <div id="html-preview" class="w-full h-full p-8 preview-pane prose prose-slate max-w-none"></div>
                </div>
            </div>
        </div>

        <div class="smart-ad-unit w-full text-center overflow-hidden transition-all duration-500 mt-4">
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5449371042798610" data-ad-slot="7594122081" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>

        <section class="mt-8 glass-panel p-8 rounded-3xl border-slate-800">
            <div class="grid lg:grid-cols-2 gap-12 items-start">
                
                <div class="space-y-6">
                    <div>
                        <h2 class="text-2xl font-bold text-white mb-3">Why Use a Local Markdown Editor?</h2>
                        <p class="text-sm text-slate-400 leading-relaxed">
                            Markdown is the standard for writers, developers, and creators. SilenVault's <strong>Markdown Architect</strong> processes your text entirely inside your browser's RAM using JavaScript. Unlike cloud-based editors, we never upload your private documentation, journals, or code snippets to an external server.
                        </p>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-blue-400 mb-2">GitHub Flavored Markdown (GFM)</h3>
                        <p class="text-sm text-slate-400 leading-relaxed">
                            Our engine fully supports GFM. This means tables, strikethroughs, task lists, and auto-linking work exactly as they do on GitHub and major CMS platforms. Use the cheat sheet on the right to master the syntax.
                        </p>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-white mb-4">Ultimate Markdown Cheat Sheet</h3>
                    
                    <div class="bg-slate-900 border border-slate-800 rounded-xl p-5 text-[13px] font-mono text-slate-300 grid sm:grid-cols-2 gap-x-8 gap-y-3">
                        <div class="flex justify-between border-b border-slate-800/60 pb-2"><span># Heading 1</span><span class="text-slate-500">H1</span></div>
                        <div class="flex justify-between border-b border-slate-800/60 pb-2"><span>## Heading 2</span><span class="text-slate-500">H2</span></div>
                        <div class="flex justify-between border-b border-slate-800/60 pb-2"><span>**Bold**</span><span class="text-slate-500">Strong</span></div>
                        <div class="flex justify-between border-b border-slate-800/60 pb-2"><span>*Italic*</span><span class="text-slate-500">Em</span></div>
                        <div class="flex justify-between border-b border-slate-800/60 pb-2"><span>~~Strike~~</span><span class="text-slate-500">Del</span></div>
                        <div class="flex justify-between sm:border-b border-slate-800/60 pb-2"><span>> Quote</span><span class="text-slate-500">Block</span></div>
                        
                        <div class="flex justify-between border-b border-slate-800/60 pb-2"><span>[Link](url)</span><span class="text-slate-500">Anchor</span></div>
                        <div class="flex justify-between border-b border-slate-800/60 pb-2"><span>![Alt](img)</span><span class="text-slate-500">Image</span></div>
                        <div class="flex justify-between border-b border-slate-800/60 pb-2"><span>`code`</span><span class="text-slate-500">Inline</span></div>
                        <div class="flex justify-between border-b border-slate-800/60 pb-2"><span>```js</span><span class="text-slate-500">Block</span></div>
                        <div class="flex justify-between border-b border-slate-800/60 pb-2"><span>- Item</span><span class="text-slate-500">List</span></div>
                        <div class="flex justify-between pb-2"><span>- [x] Task</span><span class="text-slate-500">Check</span></div>
                    </div>
                </div>

            </div>
        </section>

    </main>

    <sv-footer base-path=".."></sv-footer>

    <script>
        marked.setOptions({ breaks: true, gfm: true });

        const mdInput = document.getElementById('md-input');
        const htmlPreview = document.getElementById('html-preview');
        const wordCount = document.getElementById('wordCount');
        const charCount = document.getElementById('charCount');

        const defaultText = `# Welcome to Markdown Architect Pro\n\nWrite on the left, see the formatted HTML on the right instantly.\n\n## Features\n* **Fast:** Compiles locally in your browser.\n* **Telemetry:** Tracks your word and character count.\n* **Highlighting:** Automatic syntax highlighting for code blocks.\n\n### Developer Ready\n\n\`\`\`javascript\nfunction secureCompile() {\n  console.log("Zero data leaves your machine.");\n  return true;\n}\n\`\`\`\n\n> "Tools should empower, not extract." - SilenVault\n\n| Type | Supported |\n|---------|-----------|\n| Tables  | ✅ Yes    |\n| Task List | ✅ Yes  |\n\n- [x] Build Markdown tool\n- [ ] Conquer the internet`;

        function updateMetrics(text) {
            charCount.innerText = text.length;
            const words = text.trim() ? text.trim().split(/\s+/).length : 0;
            wordCount.innerText = words;
        }

        function compileMD() {
            const rawMD = mdInput.value;
            // 1. Parse Markdown to HTML
            htmlPreview.innerHTML = marked.parse(rawMD);
            
            // 2. Apply Prism.js Syntax Highlighting to generated code blocks
            Prism.highlightAllUnder(htmlPreview);
            
            // 3. Update Telemetry
            updateMetrics(rawMD);
            
            // 4. Save to Cache
            localStorage.setItem('sv_md_cache', rawMD);
        }

        // --- Toolbar Logic ---
        function insertSyntax(prefix, suffix) {
            const start = mdInput.selectionStart;
            const end = mdInput.selectionEnd;
            const text = mdInput.value;
            const selectedText = text.substring(start, end);
            
            // Use execCommand for Undo stack preservation
            document.execCommand('insertText', false, prefix + selectedText + suffix);
            
            // Adjust cursor position
            if (selectedText.length === 0) {
                mdInput.selectionStart = mdInput.selectionEnd = start + prefix.length;
            } else {
                mdInput.selectionStart = start;
                mdInput.selectionEnd = start + prefix.length + selectedText.length + suffix.length;
            }
            mdInput.focus();
            compileMD();
        }

        // Live typing listener
        mdInput.addEventListener('input', compileMD);

        // Allow Tab key spacing
        mdInput.addEventListener('keydown', function(e) {
            if (e.key === 'Tab') {
                e.preventDefault();
                document.execCommand('insertText', false, '    ');
            }
        });

        // Synchronize Scrolling (Smooth)
        let isSyncingLeft = false;
        let isSyncingRight = false;

        mdInput.addEventListener('scroll', () => {
            if (!isSyncingLeft) {
                isSyncingRight = true;
                const percentage = mdInput.scrollTop / (mdInput.scrollHeight - mdInput.clientHeight);
                htmlPreview.scrollTop = percentage * (htmlPreview.scrollHeight - htmlPreview.clientHeight);
                setTimeout(() => isSyncingRight = false, 10);
            }
        });

        htmlPreview.addEventListener('scroll', () => {
            if (!isSyncingRight) {
                isSyncingLeft = true;
                const percentage = htmlPreview.scrollTop / (htmlPreview.scrollHeight - htmlPreview.clientHeight);
                mdInput.scrollTop = percentage * (mdInput.scrollHeight - mdInput.clientHeight);
                setTimeout(() => isSyncingLeft = false, 10);
            }
        });

        // Export Functions
        function copyHTML() {
            const rawHTML = marked.parse(mdInput.value);
            navigator.clipboard.writeText(rawHTML).then(() => {
                const btn = document.getElementById('copyBtn');
                const orig = btn.innerHTML;
                btn.innerHTML = `<svg class="w-3.5 h-3.5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Copied!`;
                btn.classList.add('border-emerald-500', 'text-emerald-400');
                setTimeout(() => {
                    btn.innerHTML = orig;
                    btn.classList.remove('border-emerald-500', 'text-emerald-400');
                }, 2000);
            });
        }

        function downloadFile(type) {
            let content, filename, mimeType;
            const timestamp = new Date().toISOString().split('T')[0];

            if (type === 'html') {
                content = `<!DOCTYPE html>\n<html>\n<head>\n<meta charset="utf-8">\n<title>SilenVault Export</title>\n<style>\nbody { font-family: sans-serif; line-height: 1.6; max-width: 800px; margin: 40px auto; padding: 0 20px; color: #333; }\npre { background: #f4f4f4; padding: 15px; border-radius: 5px; overflow-x: auto; }\ncode { font-family: monospace; }\ntable { border-collapse: collapse; width: 100%; }\nth, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\nth { background-color: #f8f8f8; }\n</style>\n</head>\n<body>\n${marked.parse(mdInput.value)}\n</body>\n</html>`;
                filename = `silenvault_${timestamp}.html`;
                mimeType = 'text/html';
            } else {
                content = mdInput.value;
                filename = `silenvault_${timestamp}.md`;
                mimeType = 'text/markdown';
            }

            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Initialization
        window.onload = () => {
            const cached = localStorage.getItem('sv_md_cache');
            mdInput.value = cached ? cached : defaultText;
            compileMD();
        };
    </script>
</body>
</html>
